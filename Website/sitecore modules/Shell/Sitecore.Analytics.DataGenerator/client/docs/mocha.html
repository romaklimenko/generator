<!DOCTYPE html>

<html>
<head>
  <title>mocha.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="days-collection.html">
                days-collection.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="day-model.html">
                day-model.js
              </a>
            
              
              <a class="source" href="router.html">
                router.js
              </a>
            
              
              <a class="source" href="days-collection-test.html">
                days-collection-test.js
              </a>
            
              
              <a class="source" href="day-model-test.html">
                day-model-test.js
              </a>
            
              
              <a class="source" href="backbone.html">
                backbone.js
              </a>
            
              
              <a class="source" href="bootstrap.html">
                bootstrap.js
              </a>
            
              
              <a class="source" href="chai.html">
                chai.js
              </a>
            
              
              <a class="source" href="jquery.html">
                jquery.js
              </a>
            
              
              <a class="source" href="mocha.html">
                mocha.js
              </a>
            
              
              <a class="source" href="raphael.html">
                raphael.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="text.html">
                text.js
              </a>
            
              
              <a class="source" href="underscore.html">
                underscore.js
              </a>
            
              
              <a class="source" href="chart-view.html">
                chart-view.js
              </a>
            
              
              <a class="source" href="default-view.html">
                default-view.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>mocha.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>;(<span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>CommonJS require()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">require</span><span class="params">(p)</span>{</span>
    <span class="keyword">var</span> path = require.resolve(p)
      , mod = require.modules[path];
    <span class="keyword">if</span> (!mod) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'failed to require "'</span> + p + <span class="string">'"'</span>);
    <span class="keyword">if</span> (!mod.exports) {
      mod.exports = {};
      mod.call(mod.exports, mod, mod.exports, require.relative(path));
    }
    <span class="keyword">return</span> mod.exports;
  }

require.modules = {};

require.resolve = <span class="function"><span class="keyword">function</span> <span class="params">(path)</span>{</span>
    <span class="keyword">var</span> orig = path
      , reg = path + <span class="string">'.js'</span>
      , index = path + <span class="string">'/index.js'</span>;
    <span class="keyword">return</span> require.modules[reg] &amp;&amp; reg
      || require.modules[index] &amp;&amp; index
      || orig;
  };

require.register = <span class="function"><span class="keyword">function</span> <span class="params">(path, fn)</span>{</span>
    require.modules[path] = fn;
  };

require.relative = <span class="function"><span class="keyword">function</span> <span class="params">(parent)</span> {</span>
    <span class="keyword">return</span> <span class="keyword">function</span>(p){
      <span class="keyword">if</span> (<span class="string">'.'</span> != p.charAt(<span class="number">0</span>)) <span class="keyword">return</span> require(p);

      <span class="keyword">var</span> path = parent.split(<span class="string">'/'</span>)
        , segs = p.split(<span class="string">'/'</span>);
      path.pop();

      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; segs.length; i++) {
        <span class="keyword">var</span> seg = segs[i];
        <span class="keyword">if</span> (<span class="string">'..'</span> == seg) path.pop();
        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'.'</span> != seg) path.push(seg);
      }

      <span class="keyword">return</span> require(path.join(<span class="string">'/'</span>));
    };
  };


require.register(<span class="string">"browser/debug.js"</span>, <span class="keyword">function</span>(module, exports, require){

module.exports = <span class="keyword">function</span>(type){
  <span class="keyword">return</span> <span class="keyword">function</span>(){
  }
};

}); <span class="comment">// module: browser/debug.js</span>

require.register(<span class="string">"browser/diff.js"</span>, <span class="keyword">function</span>(module, exports, require){
<span class="comment">/* See license.txt for terms of usage */</span>

<span class="comment">/*
 * Text diff implementation.
 * 
 * This library supports the following APIS:
 * JsDiff.diffChars: Character by character diff
 * JsDiff.diffWords: Word (as defined by \b regex) diff which ignores whitespace
 * JsDiff.diffLines: Line based diff
 * 
 * JsDiff.diffCss: Diff targeted at CSS content
 * 
 * These methods are based on the implementation proposed in
 * "An O(ND) Difference Algorithm and its Variations" (Myers, 1986).
 * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.4.6927
 */</span>
<span class="keyword">var</span> JsDiff = (<span class="keyword">function</span>() {
  <span class="function"><span class="keyword">function</span> <span class="title">clonePath</span><span class="params">(path)</span> {</span>
    <span class="keyword">return</span> { newPos: path.newPos, components: path.components.slice(<span class="number">0</span>) };
  }
  <span class="function"><span class="keyword">function</span> <span class="title">removeEmpty</span><span class="params">(array)</span> {</span>
    <span class="keyword">var</span> ret = [];
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; array.length; i++) {
      <span class="keyword">if</span> (array[i]) {
        ret.push(array[i]);
      }
    }
    <span class="keyword">return</span> ret;
  }
  <span class="function"><span class="keyword">function</span> <span class="title">escapeHTML</span><span class="params">(s)</span> {</span>
    <span class="keyword">var</span> n = s;
    n = n.replace(<span class="regexp">/&amp;/g</span>, <span class="string">"&amp;amp;"</span>);
    n = n.replace(<span class="regexp">/&lt;/g</span>, <span class="string">"&amp;lt;"</span>);
    n = n.replace(<span class="regexp">/&gt;/g</span>, <span class="string">"&amp;gt;"</span>);
    n = n.replace(<span class="regexp">/"/g</span>, <span class="string">"&amp;quot;"</span>);

    <span class="keyword">return</span> n;
  }


  <span class="keyword">var</span> fbDiff = <span class="keyword">function</span>(ignoreWhitespace) {
    <span class="keyword">this</span>.ignoreWhitespace = ignoreWhitespace;
  };
  fbDiff.prototype = {
      diff: <span class="keyword">function</span>(oldString, newString) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Handle the identity case (this is due to unrolling editLength == 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (newString == oldString) {
          <span class="keyword">return</span> [{ value: newString }];
        }
        <span class="keyword">if</span> (!newString) {
          <span class="keyword">return</span> [{ value: oldString, removed: <span class="literal">true</span> }];
        }
        <span class="keyword">if</span> (!oldString) {
          <span class="keyword">return</span> [{ value: newString, added: <span class="literal">true</span> }];
        }

        newString = <span class="keyword">this</span>.tokenize(newString);
        oldString = <span class="keyword">this</span>.tokenize(oldString);

        <span class="keyword">var</span> newLen = newString.length, oldLen = oldString.length;
        <span class="keyword">var</span> maxEditLength = newLen + oldLen;
        <span class="keyword">var</span> bestPath = [{ newPos: -<span class="number">1</span>, components: [] }];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Seed editLength = 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> oldPos = <span class="keyword">this</span>.extractCommon(bestPath[<span class="number">0</span>], newString, oldString, <span class="number">0</span>);
        <span class="keyword">if</span> (bestPath[<span class="number">0</span>].newPos+<span class="number">1</span> &gt;= newLen &amp;&amp; oldPos+<span class="number">1</span> &gt;= oldLen) {
          <span class="keyword">return</span> bestPath[<span class="number">0</span>].components;
        }

        <span class="keyword">for</span> (<span class="keyword">var</span> editLength = <span class="number">1</span>; editLength &lt;= maxEditLength; editLength++) {
          <span class="keyword">for</span> (<span class="keyword">var</span> diagonalPath = -<span class="number">1</span>*editLength; diagonalPath &lt;= editLength; diagonalPath+=<span class="number">2</span>) {
            <span class="keyword">var</span> basePath;
            <span class="keyword">var</span> addPath = bestPath[diagonalPath-<span class="number">1</span>],
                removePath = bestPath[diagonalPath+<span class="number">1</span>];
            oldPos = (removePath ? removePath.newPos : <span class="number">0</span>) - diagonalPath;
            <span class="keyword">if</span> (addPath) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>No one else is going to attempt to use this value, clear it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              bestPath[diagonalPath-<span class="number">1</span>] = <span class="literal">undefined</span>;
            }

            <span class="keyword">var</span> canAdd = addPath &amp;&amp; addPath.newPos+<span class="number">1</span> &lt; newLen;
            <span class="keyword">var</span> canRemove = removePath &amp;&amp; <span class="number">0</span> &lt;= oldPos &amp;&amp; oldPos &lt; oldLen;
            <span class="keyword">if</span> (!canAdd &amp;&amp; !canRemove) {
              bestPath[diagonalPath] = <span class="literal">undefined</span>;
              <span class="keyword">continue</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Select the diagonal that we want to branch from. We select the prior
path whose position in the new string is the farthest from the origin
and does not pass the bounds of the diff graph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (!canAdd || (canRemove &amp;&amp; addPath.newPos &lt; removePath.newPos)) {
              basePath = clonePath(removePath);
              <span class="keyword">this</span>.pushComponent(basePath.components, oldString[oldPos], <span class="literal">undefined</span>, <span class="literal">true</span>);
            } <span class="keyword">else</span> {
              basePath = clonePath(addPath);
              basePath.newPos++;
              <span class="keyword">this</span>.pushComponent(basePath.components, newString[basePath.newPos], <span class="literal">true</span>, <span class="literal">undefined</span>);
            }

            <span class="keyword">var</span> oldPos = <span class="keyword">this</span>.extractCommon(basePath, newString, oldString, diagonalPath);

            <span class="keyword">if</span> (basePath.newPos+<span class="number">1</span> &gt;= newLen &amp;&amp; oldPos+<span class="number">1</span> &gt;= oldLen) {
              <span class="keyword">return</span> basePath.components;
            } <span class="keyword">else</span> {
              bestPath[diagonalPath] = basePath;
            }
          }
        }
      },

      pushComponent: <span class="keyword">function</span>(components, value, added, removed) {
        <span class="keyword">var</span> last = components[components.length-<span class="number">1</span>];
        <span class="keyword">if</span> (last &amp;&amp; last.added === added &amp;&amp; last.removed === removed) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>We need to clone here as the component clone operation is just
as shallow array clone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          components[components.length-<span class="number">1</span>] =
            {value: <span class="keyword">this</span>.join(last.value, value), added: added, removed: removed };
        } <span class="keyword">else</span> {
          components.push({value: value, added: added, removed: removed });
        }
      },
      extractCommon: <span class="keyword">function</span>(basePath, newString, oldString, diagonalPath) {
        <span class="keyword">var</span> newLen = newString.length,
            oldLen = oldString.length,
            newPos = basePath.newPos,
            oldPos = newPos - diagonalPath;
        <span class="keyword">while</span> (newPos+<span class="number">1</span> &lt; newLen &amp;&amp; oldPos+<span class="number">1</span> &lt; oldLen &amp;&amp; <span class="keyword">this</span>.equals(newString[newPos+<span class="number">1</span>], oldString[oldPos+<span class="number">1</span>])) {
          newPos++;
          oldPos++;
          
          <span class="keyword">this</span>.pushComponent(basePath.components, newString[newPos], <span class="literal">undefined</span>, <span class="literal">undefined</span>);
        }
        basePath.newPos = newPos;
        <span class="keyword">return</span> oldPos;
      },

      equals: <span class="keyword">function</span>(left, right) {
        <span class="keyword">var</span> reWhitespace = <span class="regexp">/\S/</span>;
        <span class="keyword">if</span> (<span class="keyword">this</span>.ignoreWhitespace &amp;&amp; !reWhitespace.test(left) &amp;&amp; !reWhitespace.test(right)) {
          <span class="keyword">return</span> <span class="literal">true</span>;
        } <span class="keyword">else</span> {
          <span class="keyword">return</span> left == right;
        }
      },
      join: <span class="keyword">function</span>(left, right) {
        <span class="keyword">return</span> left + right;
      },
      tokenize: <span class="keyword">function</span>(value) {
        <span class="keyword">return</span> value;
      }
  };
  
  <span class="keyword">var</span> CharDiff = <span class="keyword">new</span> fbDiff();
  
  <span class="keyword">var</span> WordDiff = <span class="keyword">new</span> fbDiff(<span class="literal">true</span>);
  WordDiff.tokenize = <span class="keyword">function</span>(value) {
    <span class="keyword">return</span> removeEmpty(value.split(<span class="regexp">/(\s+|\b)/</span>));
  };
  
  <span class="keyword">var</span> CssDiff = <span class="keyword">new</span> fbDiff(<span class="literal">true</span>);
  CssDiff.tokenize = <span class="keyword">function</span>(value) {
    <span class="keyword">return</span> removeEmpty(value.split(<span class="regexp">/([{}:;,]|\s+)/</span>));
  };
  
  <span class="keyword">var</span> LineDiff = <span class="keyword">new</span> fbDiff();
  LineDiff.tokenize = <span class="keyword">function</span>(value) {
    <span class="keyword">return</span> value.split(<span class="regexp">/^/m</span>);
  };
  
  <span class="keyword">return</span> {
    diffChars: <span class="keyword">function</span>(oldStr, newStr) { <span class="keyword">return</span> CharDiff.diff(oldStr, newStr); },
    diffWords: <span class="keyword">function</span>(oldStr, newStr) { <span class="keyword">return</span> WordDiff.diff(oldStr, newStr); },
    diffLines: <span class="keyword">function</span>(oldStr, newStr) { <span class="keyword">return</span> LineDiff.diff(oldStr, newStr); },

    diffCss: <span class="keyword">function</span>(oldStr, newStr) { <span class="keyword">return</span> CssDiff.diff(oldStr, newStr); },

    createPatch: <span class="keyword">function</span>(fileName, oldStr, newStr, oldHeader, newHeader) {
      <span class="keyword">var</span> ret = [];

      ret.push(<span class="string">"Index: "</span> + fileName);
      ret.push(<span class="string">"==================================================================="</span>);
      ret.push(<span class="string">"--- "</span> + fileName + (<span class="keyword">typeof</span> oldHeader === <span class="string">"undefined"</span> ? <span class="string">""</span> : <span class="string">"\t"</span> + oldHeader));
      ret.push(<span class="string">"+++ "</span> + fileName + (<span class="keyword">typeof</span> newHeader === <span class="string">"undefined"</span> ? <span class="string">""</span> : <span class="string">"\t"</span> + newHeader));

      <span class="keyword">var</span> diff = LineDiff.diff(oldStr, newStr);
      <span class="keyword">if</span> (!diff[diff.length-<span class="number">1</span>].value) {
        diff.pop();   <span class="comment">// Remove trailing newline add</span>
      }
      diff.push({value: <span class="string">""</span>, lines: []});   <span class="comment">// Append an empty value to make cleanup easier</span>

      <span class="function"><span class="keyword">function</span> <span class="title">contextLines</span><span class="params">(lines)</span> {</span>
        <span class="keyword">return</span> lines.map(<span class="keyword">function</span>(entry) { <span class="keyword">return</span> <span class="string">' '</span> + entry; });
      }
      <span class="function"><span class="keyword">function</span> <span class="title">eofNL</span><span class="params">(curRange, i, current)</span> {</span>
        <span class="keyword">var</span> last = diff[diff.length-<span class="number">2</span>],
            isLast = i === diff.length-<span class="number">2</span>,
            isLastOfType = i === diff.length-<span class="number">3</span> &amp;&amp; (current.added === !last.added || current.removed === !last.removed);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Figure out if this is the last line for the given file and missing NL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (!<span class="regexp">/\n$/</span>.test(current.value) &amp;&amp; (isLast || isLastOfType)) {
          curRange.push(<span class="string">'\\ No newline at end of file'</span>);
        }
      }

      <span class="keyword">var</span> oldRangeStart = <span class="number">0</span>, newRangeStart = <span class="number">0</span>, curRange = [],
          oldLine = <span class="number">1</span>, newLine = <span class="number">1</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; diff.length; i++) {
        <span class="keyword">var</span> current = diff[i],
            lines = current.lines || current.value.replace(<span class="regexp">/\n$/</span>, <span class="string">""</span>).split(<span class="string">"\n"</span>);
        current.lines = lines;

        <span class="keyword">if</span> (current.added || current.removed) {
          <span class="keyword">if</span> (!oldRangeStart) {
            <span class="keyword">var</span> prev = diff[i-<span class="number">1</span>];
            oldRangeStart = oldLine;
            newRangeStart = newLine;
            
            <span class="keyword">if</span> (prev) {
              curRange = contextLines(prev.lines.slice(-<span class="number">4</span>));
              oldRangeStart -= curRange.length;
              newRangeStart -= curRange.length;
            }
          }
          curRange.push.apply(curRange, lines.map(<span class="keyword">function</span>(entry) { <span class="keyword">return</span> (current.added?<span class="string">"+"</span>:<span class="string">"-"</span>) + entry; }));
          eofNL(curRange, i, current);

          <span class="keyword">if</span> (current.added) {
            newLine += lines.length;
          } <span class="keyword">else</span> {
            oldLine += lines.length;
          }
        } <span class="keyword">else</span> {
          <span class="keyword">if</span> (oldRangeStart) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Close out any changes that have been output (or join overlapping)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (lines.length &lt;= <span class="number">8</span> &amp;&amp; i &lt; diff.length-<span class="number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Overlapping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              curRange.push.apply(curRange, contextLines(lines));
            } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>end the range and output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="keyword">var</span> contextSize = Math.min(lines.length, <span class="number">4</span>);
              ret.push(
                  <span class="string">"@@ -"</span> + oldRangeStart + <span class="string">","</span> + (oldLine-oldRangeStart+contextSize)
                  + <span class="string">" +"</span> + newRangeStart + <span class="string">","</span> + (newLine-newRangeStart+contextSize)
                  + <span class="string">" @@"</span>);
              ret.push.apply(ret, curRange);
              ret.push.apply(ret, contextLines(lines.slice(<span class="number">0</span>, contextSize)));
              <span class="keyword">if</span> (lines.length &lt;= <span class="number">4</span>) {
                eofNL(ret, i, current);
              }

              oldRangeStart = <span class="number">0</span>;  newRangeStart = <span class="number">0</span>; curRange = [];
            }
          }
          oldLine += lines.length;
          newLine += lines.length;
        }
      }

      <span class="keyword">return</span> ret.join(<span class="string">'\n'</span>) + <span class="string">'\n'</span>;
    },

    convertChangesToXML: <span class="keyword">function</span>(changes){
      <span class="keyword">var</span> ret = [];
      <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; changes.length; i++) {
        <span class="keyword">var</span> change = changes[i];
        <span class="keyword">if</span> (change.added) {
          ret.push(<span class="string">"&lt;ins&gt;"</span>);
        } <span class="keyword">else</span> <span class="keyword">if</span> (change.removed) {
          ret.push(<span class="string">"&lt;del&gt;"</span>);
        }

        ret.push(escapeHTML(change.value));

        <span class="keyword">if</span> (change.added) {
          ret.push(<span class="string">"&lt;/ins&gt;"</span>);
        } <span class="keyword">else</span> <span class="keyword">if</span> (change.removed) {
          ret.push(<span class="string">"&lt;/del&gt;"</span>);
        }
      }
      <span class="keyword">return</span> ret.join(<span class="string">""</span>);
    }
  };
})();

<span class="keyword">if</span> (<span class="keyword">typeof</span> module !== <span class="string">"undefined"</span>) {
    module.exports = JsDiff;
}

}); <span class="comment">// module: browser/diff.js</span>

require.register(<span class="string">"browser/events.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module exports.
 */</span>

exports.EventEmitter = EventEmitter;

<span class="comment">/**
 * Check if `obj` is an array.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">isArray</span><span class="params">(obj)</span> {</span>
  <span class="keyword">return</span> <span class="string">'[object Array]'</span> == {}.toString.call(obj);
}

<span class="comment">/**
 * Event emitter constructor.
 *
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">EventEmitter</span><span class="params">()</span>{</span>};

<span class="comment">/**
 * Adds a listener.
 *
 * @api public
 */</span>

EventEmitter.prototype.on = <span class="function"><span class="keyword">function</span> <span class="params">(name, fn)</span> {</span>
  <span class="keyword">if</span> (!<span class="keyword">this</span>.$events) {
    <span class="keyword">this</span>.$events = {};
  }

  <span class="keyword">if</span> (!<span class="keyword">this</span>.$events[name]) {
    <span class="keyword">this</span>.$events[name] = fn;
  } <span class="keyword">else</span> <span class="keyword">if</span> (isArray(<span class="keyword">this</span>.$events[name])) {
    <span class="keyword">this</span>.$events[name].push(fn);
  } <span class="keyword">else</span> {
    <span class="keyword">this</span>.$events[name] = [<span class="keyword">this</span>.$events[name], fn];
  }

  <span class="keyword">return</span> <span class="keyword">this</span>;
};

EventEmitter.prototype.addListener = EventEmitter.prototype.on;

<span class="comment">/**
 * Adds a volatile listener.
 *
 * @api public
 */</span>

EventEmitter.prototype.once = <span class="function"><span class="keyword">function</span> <span class="params">(name, fn)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;

  <span class="function"><span class="keyword">function</span> <span class="title">on</span> <span class="params">()</span> {</span>
    self.removeListener(name, on);
    fn.apply(<span class="keyword">this</span>, arguments);
  };

  on.listener = fn;
  <span class="keyword">this</span>.on(name, on);

  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Removes a listener.
 *
 * @api public
 */</span>

EventEmitter.prototype.removeListener = <span class="function"><span class="keyword">function</span> <span class="params">(name, fn)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.$events &amp;&amp; <span class="keyword">this</span>.$events[name]) {
    <span class="keyword">var</span> list = <span class="keyword">this</span>.$events[name];

    <span class="keyword">if</span> (isArray(list)) {
      <span class="keyword">var</span> pos = -<span class="number">1</span>;

      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = list.length; i &lt; l; i++) {
        <span class="keyword">if</span> (list[i] === fn || (list[i].listener &amp;&amp; list[i].listener === fn)) {
          pos = i;
          <span class="keyword">break</span>;
        }
      }

      <span class="keyword">if</span> (pos &lt; <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="keyword">this</span>;
      }

      list.splice(pos, <span class="number">1</span>);

      <span class="keyword">if</span> (!list.length) {
        <span class="keyword">delete</span> <span class="keyword">this</span>.$events[name];
      }
    } <span class="keyword">else</span> <span class="keyword">if</span> (list === fn || (list.listener &amp;&amp; list.listener === fn)) {
      <span class="keyword">delete</span> <span class="keyword">this</span>.$events[name];
    }
  }

  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Removes all listeners for an event.
 *
 * @api public
 */</span>

EventEmitter.prototype.removeAllListeners = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> {</span>
  <span class="keyword">if</span> (name === <span class="literal">undefined</span>) {
    <span class="keyword">this</span>.$events = {};
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  <span class="keyword">if</span> (<span class="keyword">this</span>.$events &amp;&amp; <span class="keyword">this</span>.$events[name]) {
    <span class="keyword">this</span>.$events[name] = <span class="literal">null</span>;
  }

  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Gets all listeners for a certain event.
 *
 * @api public
 */</span>

EventEmitter.prototype.listeners = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> {</span>
  <span class="keyword">if</span> (!<span class="keyword">this</span>.$events) {
    <span class="keyword">this</span>.$events = {};
  }

  <span class="keyword">if</span> (!<span class="keyword">this</span>.$events[name]) {
    <span class="keyword">this</span>.$events[name] = [];
  }

  <span class="keyword">if</span> (!isArray(<span class="keyword">this</span>.$events[name])) {
    <span class="keyword">this</span>.$events[name] = [<span class="keyword">this</span>.$events[name]];
  }

  <span class="keyword">return</span> <span class="keyword">this</span>.$events[name];
};

<span class="comment">/**
 * Emits an event.
 *
 * @api public
 */</span>

EventEmitter.prototype.emit = <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> {</span>
  <span class="keyword">if</span> (!<span class="keyword">this</span>.$events) {
    <span class="keyword">return</span> <span class="literal">false</span>;
  }

  <span class="keyword">var</span> handler = <span class="keyword">this</span>.$events[name];

  <span class="keyword">if</span> (!handler) {
    <span class="keyword">return</span> <span class="literal">false</span>;
  }

  <span class="keyword">var</span> args = [].slice.call(arguments, <span class="number">1</span>);

  <span class="keyword">if</span> (<span class="string">'function'</span> == <span class="keyword">typeof</span> handler) {
    handler.apply(<span class="keyword">this</span>, args);
  } <span class="keyword">else</span> <span class="keyword">if</span> (isArray(handler)) {
    <span class="keyword">var</span> listeners = handler.slice();

    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = listeners.length; i &lt; l; i++) {
      listeners[i].apply(<span class="keyword">this</span>, args);
    }
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="literal">false</span>;
  }

  <span class="keyword">return</span> <span class="literal">true</span>;
};
}); <span class="comment">// module: browser/events.js</span>

require.register(<span class="string">"browser/fs.js"</span>, <span class="keyword">function</span>(module, exports, require){

}); <span class="comment">// module: browser/fs.js</span>

require.register(<span class="string">"browser/path.js"</span>, <span class="keyword">function</span>(module, exports, require){

}); <span class="comment">// module: browser/path.js</span>

require.register(<span class="string">"browser/progress.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Expose `Progress`.
 */</span>

module.exports = Progress;

<span class="comment">/**
 * Initialize a new `Progress` indicator.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Progress</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.percent = <span class="number">0</span>;
  <span class="keyword">this</span>.size(<span class="number">0</span>);
  <span class="keyword">this</span>.fontSize(<span class="number">11</span>);
  <span class="keyword">this</span>.font(<span class="string">'helvetica, arial, sans-serif'</span>);
}

<span class="comment">/**
 * Set progress size to `n`.
 *
 * @param {Number} n
 * @return {Progress} for chaining
 * @api public
 */</span>

Progress.prototype.size = <span class="keyword">function</span>(n){
  <span class="keyword">this</span>._size = n;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set text to `str`.
 *
 * @param {String} str
 * @return {Progress} for chaining
 * @api public
 */</span>

Progress.prototype.text = <span class="keyword">function</span>(str){
  <span class="keyword">this</span>._text = str;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set font size to `n`.
 *
 * @param {Number} n
 * @return {Progress} for chaining
 * @api public
 */</span>

Progress.prototype.fontSize = <span class="keyword">function</span>(n){
  <span class="keyword">this</span>._fontSize = n;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set font `family`.
 *
 * @param {String} family
 * @return {Progress} for chaining
 */</span>

Progress.prototype.font = <span class="keyword">function</span>(family){
  <span class="keyword">this</span>._font = family;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Update percentage to `n`.
 *
 * @param {Number} n
 * @return {Progress} for chaining
 */</span>

Progress.prototype.update = <span class="keyword">function</span>(n){
  <span class="keyword">this</span>.percent = n;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Draw on `ctx`.
 *
 * @param {CanvasRenderingContext2d} ctx
 * @return {Progress} for chaining
 */</span>

Progress.prototype.draw = <span class="keyword">function</span>(ctx){
  <span class="keyword">var</span> percent = Math.min(<span class="keyword">this</span>.percent, <span class="number">100</span>)
    , size = <span class="keyword">this</span>._size
    , half = size / <span class="number">2</span>
    , x = half
    , y = half
    , rad = half - <span class="number">1</span>
    , fontSize = <span class="keyword">this</span>._fontSize;

  ctx.font = fontSize + <span class="string">'px '</span> + <span class="keyword">this</span>._font;

  <span class="keyword">var</span> angle = Math.PI * <span class="number">2</span> * (percent / <span class="number">100</span>);
  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, size, size);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>outer circle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctx.strokeStyle = <span class="string">'#9f9f9f'</span>;
  ctx.beginPath();
  ctx.arc(x, y, rad, <span class="number">0</span>, angle, <span class="literal">false</span>);
  ctx.stroke();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>inner circle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ctx.strokeStyle = <span class="string">'#eee'</span>;
  ctx.beginPath();
  ctx.arc(x, y, rad - <span class="number">1</span>, <span class="number">0</span>, angle, <span class="literal">true</span>);
  ctx.stroke();</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> text = <span class="keyword">this</span>._text || (percent | <span class="number">0</span>) + <span class="string">'%'</span>
    , w = ctx.measureText(text).width;

  ctx.fillText(
      text
    , x - w / <span class="number">2</span> + <span class="number">1</span>
    , y + fontSize / <span class="number">2</span> - <span class="number">1</span>);

  <span class="keyword">return</span> <span class="keyword">this</span>;
};

}); <span class="comment">// module: browser/progress.js</span>

require.register(<span class="string">"browser/tty.js"</span>, <span class="keyword">function</span>(module, exports, require){

exports.isatty = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="literal">true</span>;
};

exports.getWindowSize = <span class="keyword">function</span>(){
  <span class="keyword">return</span> [window.innerHeight, window.innerWidth];
};
}); <span class="comment">// module: browser/tty.js</span>

require.register(<span class="string">"context.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Expose `Context`.
 */</span>

module.exports = Context;

<span class="comment">/**
 * Initialize a new `Context`.
 *
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Context</span><span class="params">()</span>{</span>}

<span class="comment">/**
 * Set or get the context `Runnable` to `runnable`.
 *
 * @param {Runnable} runnable
 * @return {Context}
 * @api private
 */</span>

Context.prototype.runnable = <span class="keyword">function</span>(runnable){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._runnable;
  <span class="keyword">this</span>.test = <span class="keyword">this</span>._runnable = runnable;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set test timeout `ms`.
 *
 * @param {Number} ms
 * @return {Context} self
 * @api private
 */</span>

Context.prototype.timeout = <span class="keyword">function</span>(ms){
  <span class="keyword">this</span>.runnable().timeout(ms);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set test slowness threshold `ms`.
 *
 * @param {Number} ms
 * @return {Context} self
 * @api private
 */</span>

Context.prototype.slow = <span class="keyword">function</span>(ms){
  <span class="keyword">this</span>.runnable().slow(ms);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Inspect the context void of `._runnable`.
 *
 * @return {String}
 * @api private
 */</span>

Context.prototype.inspect = <span class="keyword">function</span>(){
  <span class="keyword">return</span> JSON.stringify(<span class="keyword">this</span>, <span class="keyword">function</span>(key, val){
    <span class="keyword">if</span> (<span class="string">'_runnable'</span> == key) <span class="keyword">return</span>;
    <span class="keyword">if</span> (<span class="string">'test'</span> == key) <span class="keyword">return</span>;
    <span class="keyword">return</span> val;
  }, <span class="number">2</span>);
};

}); <span class="comment">// module: context.js</span>

require.register(<span class="string">"hook.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Runnable = require(<span class="string">'./runnable'</span>);

<span class="comment">/**
 * Expose `Hook`.
 */</span>

module.exports = Hook;

<span class="comment">/**
 * Initialize a new `Hook` with the given `title` and callback `fn`.
 *
 * @param {String} title
 * @param {Function} fn
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Hook</span><span class="params">(title, fn)</span> {</span>
  Runnable.call(<span class="keyword">this</span>, title, fn);
  <span class="keyword">this</span>.type = <span class="string">'hook'</span>;
}

<span class="comment">/**
 * Inherit from `Runnable.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Runnable.prototype;
Hook.prototype = <span class="keyword">new</span> F;
Hook.prototype.constructor = Hook;


<span class="comment">/**
 * Get or set the test `err`.
 *
 * @param {Error} err
 * @return {Error}
 * @api public
 */</span>

Hook.prototype.error = <span class="keyword">function</span>(err){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) {
    <span class="keyword">var</span> err = <span class="keyword">this</span>._error;
    <span class="keyword">this</span>._error = <span class="literal">null</span>;
    <span class="keyword">return</span> err;
  }

  <span class="keyword">this</span>._error = err;
};

}); <span class="comment">// module: hook.js</span>

require.register(<span class="string">"interfaces/bdd.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Suite = require(<span class="string">'../suite'</span>)
  , Test = require(<span class="string">'../test'</span>);

<span class="comment">/**
 * BDD-style interface:
 *
 *      describe('Array', function(){
 *        describe('#indexOf()', function(){
 *          it('should return -1 when not present', function(){
 *
 *          });
 *
 *          it('should return the index when present', function(){
 *
 *          });
 *        });
 *      });
 *
 */</span>

module.exports = <span class="keyword">function</span>(suite){
  <span class="keyword">var</span> suites = [suite];

  suite.on(<span class="string">'pre-require'</span>, <span class="keyword">function</span>(context, file, mocha){

    <span class="comment">/**
     * Execute before running tests.
     */</span>

    context.before = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].beforeAll(fn);
    };

    <span class="comment">/**
     * Execute after running tests.
     */</span>

    context.after = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].afterAll(fn);
    };

    <span class="comment">/**
     * Execute before each test case.
     */</span>

    context.beforeEach = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].beforeEach(fn);
    };

    <span class="comment">/**
     * Execute after each test case.
     */</span>

    context.afterEach = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].afterEach(fn);
    };

    <span class="comment">/**
     * Describe a "suite" with the given `title`
     * and callback `fn` containing nested suites
     * and/or tests.
     */</span>

    context.describe = context.context = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = Suite.create(suites[<span class="number">0</span>], title);
      suites.unshift(suite);
      fn.call(suite);
      suites.shift();
      <span class="keyword">return</span> suite;
    };

    <span class="comment">/**
     * Pending describe.
     */</span>

    context.xdescribe =
    context.xcontext =
    context.describe.skip = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = Suite.create(suites[<span class="number">0</span>], title);
      suite.pending = <span class="literal">true</span>;
      suites.unshift(suite);
      fn.call(suite);
      suites.shift();
    };

    <span class="comment">/**
     * Exclusive suite.
     */</span>

    context.describe.only = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = context.describe(title, fn);
      mocha.grep(suite.fullTitle());
    };

    <span class="comment">/**
     * Describe a specification or test-case
     * with the given `title` and callback `fn`
     * acting as a thunk.
     */</span>

    context.it = context.specify = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = suites[<span class="number">0</span>];
      <span class="keyword">if</span> (suite.pending) <span class="keyword">var</span> fn = <span class="literal">null</span>;
      <span class="keyword">var</span> test = <span class="keyword">new</span> Test(title, fn);
      suite.addTest(test);
      <span class="keyword">return</span> test;
    };

    <span class="comment">/**
     * Exclusive test-case.
     */</span>

    context.it.only = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> test = context.it(title, fn);
      mocha.grep(test.fullTitle());
    };

    <span class="comment">/**
     * Pending test case.
     */</span>

    context.xit =
    context.xspecify =
    context.it.skip = <span class="keyword">function</span>(title){
      context.it(title);
    };
  });
};

}); <span class="comment">// module: interfaces/bdd.js</span>

require.register(<span class="string">"interfaces/exports.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Suite = require(<span class="string">'../suite'</span>)
  , Test = require(<span class="string">'../test'</span>);

<span class="comment">/**
 * TDD-style interface:
 *
 *     exports.Array = {
 *       '#indexOf()': {
 *         'should return -1 when the value is not present': function(){
 *
 *         },
 *
 *         'should return the correct index when the value is present': function(){
 *
 *         }
 *       }
 *     };
 *
 */</span>

module.exports = <span class="keyword">function</span>(suite){
  <span class="keyword">var</span> suites = [suite];

  suite.on(<span class="string">'require'</span>, visit);

  <span class="function"><span class="keyword">function</span> <span class="title">visit</span><span class="params">(obj)</span> {</span>
    <span class="keyword">var</span> suite;
    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
      <span class="keyword">if</span> (<span class="string">'function'</span> == <span class="keyword">typeof</span> obj[key]) {
        <span class="keyword">var</span> fn = obj[key];
        <span class="keyword">switch</span> (key) {
          <span class="keyword">case</span> <span class="string">'before'</span>:
            suites[<span class="number">0</span>].beforeAll(fn);
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'after'</span>:
            suites[<span class="number">0</span>].afterAll(fn);
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'beforeEach'</span>:
            suites[<span class="number">0</span>].beforeEach(fn);
            <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="string">'afterEach'</span>:
            suites[<span class="number">0</span>].afterEach(fn);
            <span class="keyword">break</span>;
          <span class="keyword">default</span>:
            suites[<span class="number">0</span>].addTest(<span class="keyword">new</span> Test(key, fn));
        }
      } <span class="keyword">else</span> {
        <span class="keyword">var</span> suite = Suite.create(suites[<span class="number">0</span>], key);
        suites.unshift(suite);
        visit(obj[key]);
        suites.shift();
      }
    }
  }
};

}); <span class="comment">// module: interfaces/exports.js</span>

require.register(<span class="string">"interfaces/index.js"</span>, <span class="keyword">function</span>(module, exports, require){

exports.bdd = require(<span class="string">'./bdd'</span>);
exports.tdd = require(<span class="string">'./tdd'</span>);
exports.qunit = require(<span class="string">'./qunit'</span>);
exports.exports = require(<span class="string">'./exports'</span>);

}); <span class="comment">// module: interfaces/index.js</span>

require.register(<span class="string">"interfaces/qunit.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Suite = require(<span class="string">'../suite'</span>)
  , Test = require(<span class="string">'../test'</span>);

<span class="comment">/**
 * QUnit-style interface:
 *
 *     suite('Array');
 *
 *     test('#length', function(){
 *       var arr = [1,2,3];
 *       ok(arr.length == 3);
 *     });
 *
 *     test('#indexOf()', function(){
 *       var arr = [1,2,3];
 *       ok(arr.indexOf(1) == 0);
 *       ok(arr.indexOf(2) == 1);
 *       ok(arr.indexOf(3) == 2);
 *     });
 *
 *     suite('String');
 *
 *     test('#length', function(){
 *       ok('foo'.length == 3);
 *     });
 *
 */</span>

module.exports = <span class="keyword">function</span>(suite){
  <span class="keyword">var</span> suites = [suite];

  suite.on(<span class="string">'pre-require'</span>, <span class="keyword">function</span>(context, file, mocha){

    <span class="comment">/**
     * Execute before running tests.
     */</span>

    context.before = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].beforeAll(fn);
    };

    <span class="comment">/**
     * Execute after running tests.
     */</span>

    context.after = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].afterAll(fn);
    };

    <span class="comment">/**
     * Execute before each test case.
     */</span>

    context.beforeEach = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].beforeEach(fn);
    };

    <span class="comment">/**
     * Execute after each test case.
     */</span>

    context.afterEach = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].afterEach(fn);
    };

    <span class="comment">/**
     * Describe a "suite" with the given `title`.
     */</span>

    context.suite = <span class="keyword">function</span>(title){
      <span class="keyword">if</span> (suites.length &gt; <span class="number">1</span>) suites.shift();
      <span class="keyword">var</span> suite = Suite.create(suites[<span class="number">0</span>], title);
      suites.unshift(suite);
      <span class="keyword">return</span> suite;
    };

    <span class="comment">/**
     * Exclusive test-case.
     */</span>

    context.suite.only = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = context.suite(title, fn);
      mocha.grep(suite.fullTitle());
    };

    <span class="comment">/**
     * Describe a specification or test-case
     * with the given `title` and callback `fn`
     * acting as a thunk.
     */</span>

    context.test = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> test = <span class="keyword">new</span> Test(title, fn);
      suites[<span class="number">0</span>].addTest(test);
      <span class="keyword">return</span> test;
    };

    <span class="comment">/**
     * Exclusive test-case.
     */</span>

    context.test.only = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> test = context.test(title, fn);
      mocha.grep(test.fullTitle());
    };

    <span class="comment">/**
     * Pending test case.
     */</span>

    context.test.skip = <span class="keyword">function</span>(title){
      context.test(title);
    };
  });
};

}); <span class="comment">// module: interfaces/qunit.js</span>

require.register(<span class="string">"interfaces/tdd.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Suite = require(<span class="string">'../suite'</span>)
  , Test = require(<span class="string">'../test'</span>);

<span class="comment">/**
 * TDD-style interface:
 *
 *      suite('Array', function(){
 *        suite('#indexOf()', function(){
 *          suiteSetup(function(){
 *
 *          });
 *
 *          test('should return -1 when not present', function(){
 *
 *          });
 *
 *          test('should return the index when present', function(){
 *
 *          });
 *
 *          suiteTeardown(function(){
 *
 *          });
 *        });
 *      });
 *
 */</span>

module.exports = <span class="keyword">function</span>(suite){
  <span class="keyword">var</span> suites = [suite];

  suite.on(<span class="string">'pre-require'</span>, <span class="keyword">function</span>(context, file, mocha){

    <span class="comment">/**
     * Execute before each test case.
     */</span>

    context.setup = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].beforeEach(fn);
    };

    <span class="comment">/**
     * Execute after each test case.
     */</span>

    context.teardown = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].afterEach(fn);
    };

    <span class="comment">/**
     * Execute before the suite.
     */</span>

    context.suiteSetup = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].beforeAll(fn);
    };

    <span class="comment">/**
     * Execute after the suite.
     */</span>

    context.suiteTeardown = <span class="keyword">function</span>(fn){
      suites[<span class="number">0</span>].afterAll(fn);
    };

    <span class="comment">/**
     * Describe a "suite" with the given `title`
     * and callback `fn` containing nested suites
     * and/or tests.
     */</span>

    context.suite = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = Suite.create(suites[<span class="number">0</span>], title);
      suites.unshift(suite);
      fn.call(suite);
      suites.shift();
      <span class="keyword">return</span> suite;
    };

    <span class="comment">/**
     * Exclusive test-case.
     */</span>

    context.suite.only = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> suite = context.suite(title, fn);
      mocha.grep(suite.fullTitle());
    };

    <span class="comment">/**
     * Describe a specification or test-case
     * with the given `title` and callback `fn`
     * acting as a thunk.
     */</span>

    context.test = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> test = <span class="keyword">new</span> Test(title, fn);
      suites[<span class="number">0</span>].addTest(test);
      <span class="keyword">return</span> test;
    };

    <span class="comment">/**
     * Exclusive test-case.
     */</span>

    context.test.only = <span class="keyword">function</span>(title, fn){
      <span class="keyword">var</span> test = context.test(title, fn);
      mocha.grep(test.fullTitle());
    };

    <span class="comment">/**
     * Pending test case.
     */</span>

    context.test.skip = <span class="keyword">function</span>(title){
      context.test(title);
    };
  });
};

}); <span class="comment">// module: interfaces/tdd.js</span>

require.register(<span class="string">"mocha.js"</span>, <span class="keyword">function</span>(module, exports, require){
<span class="comment">/*!
 * mocha
 * Copyright(c) 2011 TJ Holowaychuk &lt;tj@vision-media.ca&gt;
 * MIT Licensed
 */</span>

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> path = require(<span class="string">'browser/path'</span>)
  , utils = require(<span class="string">'./utils'</span>);

<span class="comment">/**
 * Expose `Mocha`.
 */</span>

exports = module.exports = Mocha;

<span class="comment">/**
 * Expose internals.
 */</span>

exports.utils = utils;
exports.interfaces = require(<span class="string">'./interfaces'</span>);
exports.reporters = require(<span class="string">'./reporters'</span>);
exports.Runnable = require(<span class="string">'./runnable'</span>);
exports.Context = require(<span class="string">'./context'</span>);
exports.Runner = require(<span class="string">'./runner'</span>);
exports.Suite = require(<span class="string">'./suite'</span>);
exports.Hook = require(<span class="string">'./hook'</span>);
exports.Test = require(<span class="string">'./test'</span>);

<span class="comment">/**
 * Return image `name` path.
 *
 * @param {String} name
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">image</span><span class="params">(name)</span> {</span>
  <span class="keyword">return</span> __dirname + <span class="string">'/../images/'</span> + name + <span class="string">'.png'</span>;
}

<span class="comment">/**
 * Setup mocha with `options`.
 *
 * Options:
 *
 *   - `ui` name "bdd", "tdd", "exports" etc
 *   - `reporter` reporter instance, defaults to `mocha.reporters.Dot`
 *   - `globals` array of accepted globals
 *   - `timeout` timeout in milliseconds
 *   - `bail` bail on the first test failure
 *   - `slow` milliseconds to wait before considering a test slow
 *   - `ignoreLeaks` ignore global leaks
 *   - `grep` string or regexp to filter tests with
 *
 * @param {Object} options
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Mocha</span><span class="params">(options)</span> {</span>
  options = options || {};
  <span class="keyword">this</span>.files = [];
  <span class="keyword">this</span>.options = options;
  <span class="keyword">this</span>.grep(options.grep);
  <span class="keyword">this</span>.suite = <span class="keyword">new</span> exports.Suite(<span class="string">''</span>, <span class="keyword">new</span> exports.Context);
  <span class="keyword">this</span>.ui(options.ui);
  <span class="keyword">this</span>.bail(options.bail);
  <span class="keyword">this</span>.reporter(options.reporter);
  <span class="keyword">if</span> (options.timeout) <span class="keyword">this</span>.timeout(options.timeout);
  <span class="keyword">if</span> (options.slow) <span class="keyword">this</span>.slow(options.slow);
}

<span class="comment">/**
 * Enable or disable bailing on the first failure.
 *
 * @param {Boolean} [bail]
 * @api public
 */</span>

Mocha.prototype.bail = <span class="keyword">function</span>(bail){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) bail = <span class="literal">true</span>;
  <span class="keyword">this</span>.suite.bail(bail);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Add test `file`.
 *
 * @param {String} file
 * @api public
 */</span>

Mocha.prototype.addFile = <span class="keyword">function</span>(file){
  <span class="keyword">this</span>.files.push(file);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set reporter to `reporter`, defaults to "dot".
 *
 * @param {String|Function} reporter name or constructor
 * @api public
 */</span>

Mocha.prototype.reporter = <span class="keyword">function</span>(reporter){
  <span class="keyword">if</span> (<span class="string">'function'</span> == <span class="keyword">typeof</span> reporter) {
    <span class="keyword">this</span>._reporter = reporter;
  } <span class="keyword">else</span> {
    reporter = reporter || <span class="string">'dot'</span>;
    <span class="keyword">try</span> {
      <span class="keyword">this</span>._reporter = require(<span class="string">'./reporters/'</span> + reporter);
    } <span class="keyword">catch</span> (err) {
      <span class="keyword">this</span>._reporter = require(reporter);
    }
    <span class="keyword">if</span> (!<span class="keyword">this</span>._reporter) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'invalid reporter "'</span> + reporter + <span class="string">'"'</span>);
  }
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set test UI `name`, defaults to "bdd".
 *
 * @param {String} bdd
 * @api public
 */</span>

Mocha.prototype.ui = <span class="keyword">function</span>(name){
  name = name || <span class="string">'bdd'</span>;
  <span class="keyword">this</span>._ui = exports.interfaces[name];
  <span class="keyword">if</span> (!<span class="keyword">this</span>._ui) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'invalid interface "'</span> + name + <span class="string">'"'</span>);
  <span class="keyword">this</span>._ui = <span class="keyword">this</span>._ui(<span class="keyword">this</span>.suite);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Load registered files.
 *
 * @api private
 */</span>

Mocha.prototype.loadFiles = <span class="keyword">function</span>(fn){
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">var</span> suite = <span class="keyword">this</span>.suite;
  <span class="keyword">var</span> pending = <span class="keyword">this</span>.files.length;
  <span class="keyword">this</span>.files.forEach(<span class="keyword">function</span>(file){
    file = path.resolve(file);
    suite.emit(<span class="string">'pre-require'</span>, global, file, self);
    suite.emit(<span class="string">'require'</span>, require(file), file, self);
    suite.emit(<span class="string">'post-require'</span>, global, file, self);
    --pending || (fn &amp;&amp; fn());
  });
};

<span class="comment">/**
 * Enable growl support.
 *
 * @api private
 */</span>

Mocha.prototype._growl = <span class="keyword">function</span>(runner, reporter) {
  <span class="keyword">var</span> notify = require(<span class="string">'growl'</span>);

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    <span class="keyword">var</span> stats = reporter.stats;
    <span class="keyword">if</span> (stats.failures) {
      <span class="keyword">var</span> msg = stats.failures + <span class="string">' of '</span> + runner.total + <span class="string">' tests failed'</span>;
      notify(msg, { name: <span class="string">'mocha'</span>, title: <span class="string">'Failed'</span>, image: image(<span class="string">'error'</span>) });
    } <span class="keyword">else</span> {
      notify(stats.passes + <span class="string">' tests passed in '</span> + stats.duration + <span class="string">'ms'</span>, {
          name: <span class="string">'mocha'</span>
        , title: <span class="string">'Passed'</span>
        , image: image(<span class="string">'ok'</span>)
      });
    }
  });
};

<span class="comment">/**
 * Add regexp to grep, if `re` is a string it is escaped.
 *
 * @param {RegExp|String} re
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.grep = <span class="keyword">function</span>(re){
  <span class="keyword">this</span>.options.grep = <span class="string">'string'</span> == <span class="keyword">typeof</span> re
    ? <span class="keyword">new</span> RegExp(utils.escapeRegexp(re))
    : re;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Invert `.grep()` matches.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.invert = <span class="keyword">function</span>(){
  <span class="keyword">this</span>.options.invert = <span class="literal">true</span>;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Ignore global leaks.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.ignoreLeaks = <span class="keyword">function</span>(){
  <span class="keyword">this</span>.options.ignoreLeaks = <span class="literal">true</span>;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Enable global leak checking.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.checkLeaks = <span class="keyword">function</span>(){
  <span class="keyword">this</span>.options.ignoreLeaks = <span class="literal">false</span>;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Enable growl support.
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.growl = <span class="keyword">function</span>(){
  <span class="keyword">this</span>.options.growl = <span class="literal">true</span>;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Ignore `globals` array or string.
 *
 * @param {Array|String} globals
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.globals = <span class="keyword">function</span>(globals){
  <span class="keyword">this</span>.options.globals = (<span class="keyword">this</span>.options.globals || []).concat(globals);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set the timeout in milliseconds.
 *
 * @param {Number} timeout
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.timeout = <span class="keyword">function</span>(timeout){
  <span class="keyword">this</span>.suite.timeout(timeout);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set slowness threshold in milliseconds.
 *
 * @param {Number} slow
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.slow = <span class="keyword">function</span>(slow){
  <span class="keyword">this</span>.suite.slow(slow);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Makes all tests async (accepting a callback)
 *
 * @return {Mocha}
 * @api public
 */</span>

Mocha.prototype.asyncOnly = <span class="keyword">function</span>(){
  <span class="keyword">this</span>.options.asyncOnly = <span class="literal">true</span>;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Run tests and invoke `fn()` when complete.
 *
 * @param {Function} fn
 * @return {Runner}
 * @api public
 */</span>

Mocha.prototype.run = <span class="keyword">function</span>(fn){
  <span class="keyword">if</span> (<span class="keyword">this</span>.files.length) <span class="keyword">this</span>.loadFiles();
  <span class="keyword">var</span> suite = <span class="keyword">this</span>.suite;
  <span class="keyword">var</span> options = <span class="keyword">this</span>.options;
  <span class="keyword">var</span> runner = <span class="keyword">new</span> exports.Runner(suite);
  <span class="keyword">var</span> reporter = <span class="keyword">new</span> <span class="keyword">this</span>._reporter(runner);
  runner.ignoreLeaks = <span class="literal">false</span> !== options.ignoreLeaks;
  runner.asyncOnly = options.asyncOnly;
  <span class="keyword">if</span> (options.grep) runner.grep(options.grep, options.invert);
  <span class="keyword">if</span> (options.globals) runner.globals(options.globals);
  <span class="keyword">if</span> (options.growl) <span class="keyword">this</span>._growl(runner, reporter);
  <span class="keyword">return</span> runner.run(fn);
};

}); <span class="comment">// module: mocha.js</span>

require.register(<span class="string">"ms.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Helpers.
 */</span>

<span class="keyword">var</span> s = <span class="number">1000</span>;
<span class="keyword">var</span> m = s * <span class="number">60</span>;
<span class="keyword">var</span> h = m * <span class="number">60</span>;
<span class="keyword">var</span> d = h * <span class="number">24</span>;

<span class="comment">/**
 * Parse or format the given `val`.
 *
 * @param {String|Number} val
 * @return {String|Number}
 * @api public
 */</span>

module.exports = <span class="keyword">function</span>(val){
  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> val) <span class="keyword">return</span> parse(val);
  <span class="keyword">return</span> format(val);
}

<span class="comment">/**
 * Parse the given `str` and return milliseconds.
 *
 * @param {String} str
 * @return {Number}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">parse</span><span class="params">(str)</span> {</span>
  <span class="keyword">var</span> m = <span class="regexp">/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i</span>.exec(str);
  <span class="keyword">if</span> (!m) <span class="keyword">return</span>;
  <span class="keyword">var</span> n = parseFloat(m[<span class="number">1</span>]);
  <span class="keyword">var</span> type = (m[<span class="number">2</span>] || <span class="string">'ms'</span>).toLowerCase();
  <span class="keyword">switch</span> (type) {
    <span class="keyword">case</span> <span class="string">'years'</span>:
    <span class="keyword">case</span> <span class="string">'year'</span>:
    <span class="keyword">case</span> <span class="string">'y'</span>:
      <span class="keyword">return</span> n * <span class="number">31557600000</span>;
    <span class="keyword">case</span> <span class="string">'days'</span>:
    <span class="keyword">case</span> <span class="string">'day'</span>:
    <span class="keyword">case</span> <span class="string">'d'</span>:
      <span class="keyword">return</span> n * <span class="number">86400000</span>;
    <span class="keyword">case</span> <span class="string">'hours'</span>:
    <span class="keyword">case</span> <span class="string">'hour'</span>:
    <span class="keyword">case</span> <span class="string">'h'</span>:
      <span class="keyword">return</span> n * <span class="number">3600000</span>;
    <span class="keyword">case</span> <span class="string">'minutes'</span>:
    <span class="keyword">case</span> <span class="string">'minute'</span>:
    <span class="keyword">case</span> <span class="string">'m'</span>:
      <span class="keyword">return</span> n * <span class="number">60000</span>;
    <span class="keyword">case</span> <span class="string">'seconds'</span>:
    <span class="keyword">case</span> <span class="string">'second'</span>:
    <span class="keyword">case</span> <span class="string">'s'</span>:
      <span class="keyword">return</span> n * <span class="number">1000</span>;
    <span class="keyword">case</span> <span class="string">'ms'</span>:
      <span class="keyword">return</span> n;
  }
}

<span class="comment">/**
 * Format the given `ms`.
 *
 * @param {Number} ms
 * @return {String}
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">format</span><span class="params">(ms)</span> {</span>
  <span class="keyword">if</span> (ms == d) <span class="keyword">return</span> Math.round(ms / d) + <span class="string">' day'</span>;
  <span class="keyword">if</span> (ms &gt; d) <span class="keyword">return</span> Math.round(ms / d) + <span class="string">' days'</span>;
  <span class="keyword">if</span> (ms == h) <span class="keyword">return</span> Math.round(ms / h) + <span class="string">' hour'</span>;
  <span class="keyword">if</span> (ms &gt; h) <span class="keyword">return</span> Math.round(ms / h) + <span class="string">' hours'</span>;
  <span class="keyword">if</span> (ms == m) <span class="keyword">return</span> Math.round(ms / m) + <span class="string">' minute'</span>;
  <span class="keyword">if</span> (ms &gt; m) <span class="keyword">return</span> Math.round(ms / m) + <span class="string">' minutes'</span>;
  <span class="keyword">if</span> (ms == s) <span class="keyword">return</span> Math.round(ms / s) + <span class="string">' second'</span>;
  <span class="keyword">if</span> (ms &gt; s) <span class="keyword">return</span> Math.round(ms / s) + <span class="string">' seconds'</span>;
  <span class="keyword">return</span> ms + <span class="string">' ms'</span>;
}
}); <span class="comment">// module: ms.js</span>

require.register(<span class="string">"reporters/base.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> tty = require(<span class="string">'browser/tty'</span>)
  , diff = require(<span class="string">'browser/diff'</span>)
  , ms = require(<span class="string">'../ms'</span>);

<span class="comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="keyword">var</span> Date = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="comment">/**
 * Check if both stdio streams are associated with a tty.
 */</span>

<span class="keyword">var</span> isatty = tty.isatty(<span class="number">1</span>) &amp;&amp; tty.isatty(<span class="number">2</span>);

<span class="comment">/**
 * Expose `Base`.
 */</span>

exports = module.exports = Base;

<span class="comment">/**
 * Enable coloring by default.
 */</span>

exports.useColors = isatty;

<span class="comment">/**
 * Default color map.
 */</span>

exports.colors = {
    <span class="string">'pass'</span>: <span class="number">90</span>
  , <span class="string">'fail'</span>: <span class="number">31</span>
  , <span class="string">'bright pass'</span>: <span class="number">92</span>
  , <span class="string">'bright fail'</span>: <span class="number">91</span>
  , <span class="string">'bright yellow'</span>: <span class="number">93</span>
  , <span class="string">'pending'</span>: <span class="number">36</span>
  , <span class="string">'suite'</span>: <span class="number">0</span>
  , <span class="string">'error title'</span>: <span class="number">0</span>
  , <span class="string">'error message'</span>: <span class="number">31</span>
  , <span class="string">'error stack'</span>: <span class="number">90</span>
  , <span class="string">'checkmark'</span>: <span class="number">32</span>
  , <span class="string">'fast'</span>: <span class="number">90</span>
  , <span class="string">'medium'</span>: <span class="number">33</span>
  , <span class="string">'slow'</span>: <span class="number">31</span>
  , <span class="string">'green'</span>: <span class="number">32</span>
  , <span class="string">'light'</span>: <span class="number">90</span>
  , <span class="string">'diff gutter'</span>: <span class="number">90</span>
  , <span class="string">'diff added'</span>: <span class="number">42</span>
  , <span class="string">'diff removed'</span>: <span class="number">41</span>
};

<span class="comment">/**
 * Default symbol map.
 */</span>

exports.symbols = {
  ok: <span class="string">''</span>,
  err: <span class="string">''</span>,
  dot: <span class="string">''</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>With node.js on Windows: use symbols available in terminal default fonts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">if</span> (<span class="string">'win32'</span> == process.platform) {
  exports.symbols.ok = <span class="string">'\u221A'</span>;
  exports.symbols.err = <span class="string">'\u00D7'</span>;
  exports.symbols.dot = <span class="string">'.'</span>;
}

<span class="comment">/**
 * Color `str` with the given `type`,
 * allowing colors to be disabled,
 * as well as user-defined color
 * schemes.
 *
 * @param {String} type
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

<span class="keyword">var</span> color = exports.color = <span class="keyword">function</span>(type, str) {
  <span class="keyword">if</span> (!exports.useColors) <span class="keyword">return</span> str;
  <span class="keyword">return</span> <span class="string">'\u001b['</span> + exports.colors[type] + <span class="string">'m'</span> + str + <span class="string">'\u001b[0m'</span>;
};

<span class="comment">/**
 * Expose term window size, with some
 * defaults for when stderr is not a tty.
 */</span>

exports.window = {
  width: isatty
    ? process.stdout.getWindowSize
      ? process.stdout.getWindowSize(<span class="number">1</span>)[<span class="number">0</span>]
      : tty.getWindowSize()[<span class="number">1</span>]
    : <span class="number">75</span>
};

<span class="comment">/**
 * Expose some basic cursor interactions
 * that are common among reporters.
 */</span>

exports.cursor = {
  hide: <span class="keyword">function</span>(){
    process.stdout.write(<span class="string">'\u001b[?25l'</span>);
  },

  show: <span class="keyword">function</span>(){
    process.stdout.write(<span class="string">'\u001b[?25h'</span>);
  },

  deleteLine: <span class="keyword">function</span>(){
    process.stdout.write(<span class="string">'\u001b[2K'</span>);
  },

  beginningOfLine: <span class="keyword">function</span>(){
    process.stdout.write(<span class="string">'\u001b[0G'</span>);
  },

  CR: <span class="keyword">function</span>(){
    exports.cursor.deleteLine();
    exports.cursor.beginningOfLine();
  }
};

<span class="comment">/**
 * Outut the given `failures` as a list.
 *
 * @param {Array} failures
 * @api public
 */</span>

exports.list = <span class="keyword">function</span>(failures){
  console.error();
  failures.forEach(<span class="keyword">function</span>(test, i){</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> fmt = color(<span class="string">'error title'</span>, <span class="string">'  %s) %s:\n'</span>)
      + color(<span class="string">'error message'</span>, <span class="string">'     %s'</span>)
      + color(<span class="string">'error stack'</span>, <span class="string">'\n%s\n'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>msg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> err = test.err
      , message = err.message || <span class="string">''</span>
      , stack = err.stack || message
      , index = stack.indexOf(message) + message.length
      , msg = stack.slice(<span class="number">0</span>, index)
      , actual = err.actual
      , expected = err.expected
      , escape = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>explicitly show diff</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (err.showDiff) {
      escape = <span class="literal">false</span>;
      err.actual = actual = JSON.stringify(actual, <span class="literal">null</span>, <span class="number">2</span>);
      err.expected = expected = JSON.stringify(expected, <span class="literal">null</span>, <span class="number">2</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>actual / expected diff</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> actual &amp;&amp; <span class="string">'string'</span> == <span class="keyword">typeof</span> expected) {
      msg = errorDiff(err, <span class="string">'Words'</span>, escape);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>linenos</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> lines = msg.split(<span class="string">'\n'</span>);
      <span class="keyword">if</span> (lines.length &gt; <span class="number">4</span>) {
        <span class="keyword">var</span> width = String(lines.length).length;
        msg = lines.map(<span class="keyword">function</span>(str, i){
          <span class="keyword">return</span> pad(++i, width) + <span class="string">' |'</span> + <span class="string">' '</span> + str;
        }).join(<span class="string">'\n'</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>legend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      msg = <span class="string">'\n'</span>
        + color(<span class="string">'diff removed'</span>, <span class="string">'actual'</span>)
        + <span class="string">' '</span>
        + color(<span class="string">'diff added'</span>, <span class="string">'expected'</span>)
        + <span class="string">'\n\n'</span>
        + msg
        + <span class="string">'\n'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>indent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      msg = msg.replace(<span class="regexp">/^/gm</span>, <span class="string">'      '</span>);

      fmt = color(<span class="string">'error title'</span>, <span class="string">'  %s) %s:\n%s'</span>)
        + color(<span class="string">'error stack'</span>, <span class="string">'\n%s\n'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>indent stack trace without msg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stack = stack.slice(index ? index + <span class="number">1</span> : index)
      .replace(<span class="regexp">/^/gm</span>, <span class="string">'  '</span>);

    console.error(fmt, (i + <span class="number">1</span>), test.fullTitle(), msg, stack);
  });
};

<span class="comment">/**
 * Initialize a new `Base` reporter.
 *
 * All other reporters generally
 * inherit from this reporter, providing
 * stats such as test duration, number
 * of tests passed / failed etc.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Base</span><span class="params">(runner)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats = { suites: <span class="number">0</span>, tests: <span class="number">0</span>, passes: <span class="number">0</span>, pending: <span class="number">0</span>, failures: <span class="number">0</span> }
    , failures = <span class="keyword">this</span>.failures = [];

  <span class="keyword">if</span> (!runner) <span class="keyword">return</span>;
  <span class="keyword">this</span>.runner = runner;

  runner.stats = stats;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    stats.start = <span class="keyword">new</span> Date;
  });

  runner.on(<span class="string">'suite'</span>, <span class="keyword">function</span>(suite){
    stats.suites = stats.suites || <span class="number">0</span>;
    suite.root || stats.suites++;
  });

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test){
    stats.tests = stats.tests || <span class="number">0</span>;
    stats.tests++;
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    stats.passes = stats.passes || <span class="number">0</span>;

    <span class="keyword">var</span> medium = test.slow() / <span class="number">2</span>;
    test.speed = test.duration &gt; test.slow()
      ? <span class="string">'slow'</span>
      : test.duration &gt; medium
        ? <span class="string">'medium'</span>
        : <span class="string">'fast'</span>;

    stats.passes++;
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    stats.failures = stats.failures || <span class="number">0</span>;
    stats.failures++;
    test.err = err;
    failures.push(test);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    stats.end = <span class="keyword">new</span> Date;
    stats.duration = <span class="keyword">new</span> Date - stats.start;
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(){
    stats.pending++;
  });
}

<span class="comment">/**
 * Output common epilogue used by many of
 * the bundled reporters.
 *
 * @api public
 */</span>

Base.prototype.epilogue = <span class="keyword">function</span>(){
  <span class="keyword">var</span> stats = <span class="keyword">this</span>.stats
    , fmt
    , tests;

  console.log();

  <span class="function"><span class="keyword">function</span> <span class="title">pluralize</span><span class="params">(n)</span> {</span>
    <span class="keyword">return</span> <span class="number">1</span> == n ? <span class="string">'test'</span> : <span class="string">'tests'</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>failure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (stats.failures) {
    fmt = color(<span class="string">'bright fail'</span>, <span class="string">'  '</span> + exports.symbols.err)
      + color(<span class="string">'fail'</span>, <span class="string">' %d of %d %s failed'</span>)
      + color(<span class="string">'light'</span>, <span class="string">':'</span>)

    console.error(fmt,
      stats.failures,
      <span class="keyword">this</span>.runner.total,
      pluralize(<span class="keyword">this</span>.runner.total));

    Base.list(<span class="keyword">this</span>.failures);
    console.error();
    <span class="keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>pass</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fmt = color(<span class="string">'bright pass'</span>, <span class="string">' '</span>)
    + color(<span class="string">'green'</span>, <span class="string">' %d %s complete'</span>)
    + color(<span class="string">'light'</span>, <span class="string">' (%s)'</span>);

  console.log(fmt,
    stats.tests || <span class="number">0</span>,
    pluralize(stats.tests),
    ms(stats.duration));</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>pending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (stats.pending) {
    fmt = color(<span class="string">'pending'</span>, <span class="string">' '</span>)
      + color(<span class="string">'pending'</span>, <span class="string">' %d %s pending'</span>);

    console.log(fmt, stats.pending, pluralize(stats.pending));
  }

  console.log();
};

<span class="comment">/**
 * Pad the given `str` to `len`.
 *
 * @param {String} str
 * @param {String} len
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">pad</span><span class="params">(str, len)</span> {</span>
  str = String(str);
  <span class="keyword">return</span> Array(len - str.length + <span class="number">1</span>).join(<span class="string">' '</span>) + str;
}

<span class="comment">/**
 * Return a character diff for `err`.
 *
 * @param {Error} err
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">errorDiff</span><span class="params">(err, type, escape)</span> {</span>
  <span class="keyword">return</span> diff[<span class="string">'diff'</span> + type](err.actual, err.expected).map(<span class="keyword">function</span>(str){
    <span class="keyword">if</span> (escape) {
      str.value = str.value
        .replace(<span class="regexp">/\t/g</span>, <span class="string">'&lt;tab&gt;'</span>)
        .replace(<span class="regexp">/\r/g</span>, <span class="string">'&lt;CR&gt;'</span>)
        .replace(<span class="regexp">/\n/g</span>, <span class="string">'&lt;LF&gt;\n'</span>);
    }
    <span class="keyword">if</span> (str.added) <span class="keyword">return</span> colorLines(<span class="string">'diff added'</span>, str.value);
    <span class="keyword">if</span> (str.removed) <span class="keyword">return</span> colorLines(<span class="string">'diff removed'</span>, str.value);
    <span class="keyword">return</span> str.value;
  }).join(<span class="string">''</span>);
}

<span class="comment">/**
 * Color lines for `str`, using the color `name`.
 *
 * @param {String} name
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">colorLines</span><span class="params">(name, str)</span> {</span>
  <span class="keyword">return</span> str.split(<span class="string">'\n'</span>).map(<span class="keyword">function</span>(str){
    <span class="keyword">return</span> color(name, str);
  }).join(<span class="string">'\n'</span>);
}

}); <span class="comment">// module: reporters/base.js</span>

require.register(<span class="string">"reporters/doc.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , utils = require(<span class="string">'../utils'</span>);

<span class="comment">/**
 * Expose `Doc`.
 */</span>

exports = module.exports = Doc;

<span class="comment">/**
 * Initialize a new `Doc` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Doc</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , total = runner.total
    , indents = <span class="number">2</span>;

  <span class="function"><span class="keyword">function</span> <span class="title">indent</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> Array(indents).join(<span class="string">'  '</span>);
  }

  runner.on(<span class="string">'suite'</span>, <span class="keyword">function</span>(suite){
    <span class="keyword">if</span> (suite.root) <span class="keyword">return</span>;
    ++indents;
    console.log(<span class="string">'%s&lt;section class="suite"&gt;'</span>, indent());
    ++indents;
    console.log(<span class="string">'%s&lt;h1&gt;%s&lt;/h1&gt;'</span>, indent(), utils.escape(suite.title));
    console.log(<span class="string">'%s&lt;dl&gt;'</span>, indent());
  });

  runner.on(<span class="string">'suite end'</span>, <span class="keyword">function</span>(suite){
    <span class="keyword">if</span> (suite.root) <span class="keyword">return</span>;
    console.log(<span class="string">'%s&lt;/dl&gt;'</span>, indent());
    --indents;
    console.log(<span class="string">'%s&lt;/section&gt;'</span>, indent());
    --indents;
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    console.log(<span class="string">'%s  &lt;dt&gt;%s&lt;/dt&gt;'</span>, indent(), utils.escape(test.title));
    <span class="keyword">var</span> code = utils.escape(utils.clean(test.fn.toString()));
    console.log(<span class="string">'%s  &lt;dd&gt;&lt;pre&gt;&lt;code&gt;%s&lt;/code&gt;&lt;/pre&gt;&lt;/dd&gt;'</span>, indent(), code);
  });
}

}); <span class="comment">// module: reporters/doc.js</span>

require.register(<span class="string">"reporters/dot.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , color = Base.color;

<span class="comment">/**
 * Expose `Dot`.
 */</span>

exports = module.exports = Dot;

<span class="comment">/**
 * Initialize a new `Dot` matrix test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Dot</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , width = Base.window.width * <span class="number">.75</span> | <span class="number">0</span>
    , n = <span class="number">0</span>;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    process.stdout.write(<span class="string">'\n  '</span>);
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(test){
    process.stdout.write(color(<span class="string">'pending'</span>, Base.symbols.dot));
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    <span class="keyword">if</span> (++n % width == <span class="number">0</span>) process.stdout.write(<span class="string">'\n  '</span>);
    <span class="keyword">if</span> (<span class="string">'slow'</span> == test.speed) {
      process.stdout.write(color(<span class="string">'bright yellow'</span>, Base.symbols.dot));
    } <span class="keyword">else</span> {
      process.stdout.write(color(test.speed, Base.symbols.dot));
    }
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    <span class="keyword">if</span> (++n % width == <span class="number">0</span>) process.stdout.write(<span class="string">'\n  '</span>);
    process.stdout.write(color(<span class="string">'fail'</span>, Base.symbols.dot));
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    console.log();
    self.epilogue();
  });
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
Dot.prototype = <span class="keyword">new</span> F;
Dot.prototype.constructor = Dot;

}); <span class="comment">// module: reporters/dot.js</span>

require.register(<span class="string">"reporters/html-cov.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> JSONCov = require(<span class="string">'./json-cov'</span>)
  , fs = require(<span class="string">'browser/fs'</span>);

<span class="comment">/**
 * Expose `HTMLCov`.
 */</span>

exports = module.exports = HTMLCov;

<span class="comment">/**
 * Initialize a new `JsCoverage` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">HTMLCov</span><span class="params">(runner)</span> {</span>
  <span class="keyword">var</span> jade = require(<span class="string">'jade'</span>)
    , file = __dirname + <span class="string">'/templates/coverage.jade'</span>
    , str = fs.readFileSync(file, <span class="string">'utf8'</span>)
    , fn = jade.compile(str, { filename: file })
    , self = <span class="keyword">this</span>;

  JSONCov.call(<span class="keyword">this</span>, runner, <span class="literal">false</span>);

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    process.stdout.write(fn({
        cov: self.cov
      , coverageClass: coverageClass
    }));
  });
}

<span class="comment">/**
 * Return coverage class for `n`.
 *
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">coverageClass</span><span class="params">(n)</span> {</span>
  <span class="keyword">if</span> (n &gt;= <span class="number">75</span>) <span class="keyword">return</span> <span class="string">'high'</span>;
  <span class="keyword">if</span> (n &gt;= <span class="number">50</span>) <span class="keyword">return</span> <span class="string">'medium'</span>;
  <span class="keyword">if</span> (n &gt;= <span class="number">25</span>) <span class="keyword">return</span> <span class="string">'low'</span>;
  <span class="keyword">return</span> <span class="string">'terrible'</span>;
}
}); <span class="comment">// module: reporters/html-cov.js</span>

require.register(<span class="string">"reporters/html.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , utils = require(<span class="string">'../utils'</span>)
  , Progress = require(<span class="string">'../browser/progress'</span>)
  , escape = utils.escape;

<span class="comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="keyword">var</span> Date = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="comment">/**
 * Expose `Doc`.
 */</span>

exports = module.exports = HTML;

<span class="comment">/**
 * Stats template.
 */</span>

<span class="keyword">var</span> statsTemplate = <span class="string">'&lt;ul id="mocha-stats"&gt;'</span>
  + <span class="string">'&lt;li class="progress"&gt;&lt;canvas width="40" height="40"&gt;&lt;/canvas&gt;&lt;/li&gt;'</span>
  + <span class="string">'&lt;li class="passes"&gt;&lt;a href="#"&gt;passes:&lt;/a&gt; &lt;em&gt;0&lt;/em&gt;&lt;/li&gt;'</span>
  + <span class="string">'&lt;li class="failures"&gt;&lt;a href="#"&gt;failures:&lt;/a&gt; &lt;em&gt;0&lt;/em&gt;&lt;/li&gt;'</span>
  + <span class="string">'&lt;li class="duration"&gt;duration: &lt;em&gt;0&lt;/em&gt;s&lt;/li&gt;'</span>
  + <span class="string">'&lt;/ul&gt;'</span>;

<span class="comment">/**
 * Initialize a new `Doc` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">HTML</span><span class="params">(runner, root)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , total = runner.total
    , stat = fragment(statsTemplate)
    , items = stat.getElementsByTagName(<span class="string">'li'</span>)
    , passes = items[<span class="number">1</span>].getElementsByTagName(<span class="string">'em'</span>)[<span class="number">0</span>]
    , passesLink = items[<span class="number">1</span>].getElementsByTagName(<span class="string">'a'</span>)[<span class="number">0</span>]
    , failures = items[<span class="number">2</span>].getElementsByTagName(<span class="string">'em'</span>)[<span class="number">0</span>]
    , failuresLink = items[<span class="number">2</span>].getElementsByTagName(<span class="string">'a'</span>)[<span class="number">0</span>]
    , duration = items[<span class="number">3</span>].getElementsByTagName(<span class="string">'em'</span>)[<span class="number">0</span>]
    , canvas = stat.getElementsByTagName(<span class="string">'canvas'</span>)[<span class="number">0</span>]
    , report = fragment(<span class="string">'&lt;ul id="mocha-report"&gt;&lt;/ul&gt;'</span>)
    , stack = [report]
    , progress
    , ctx

  root = root || document.getElementById(<span class="string">'mocha'</span>);

  <span class="keyword">if</span> (canvas.getContext) {
    <span class="keyword">var</span> ratio = window.devicePixelRatio || <span class="number">1</span>;
    canvas.style.width = canvas.width;
    canvas.style.height = canvas.height;
    canvas.width *= ratio;
    canvas.height *= ratio;
    ctx = canvas.getContext(<span class="string">'2d'</span>);
    ctx.scale(ratio, ratio);
    progress = <span class="keyword">new</span> Progress;
  }

  <span class="keyword">if</span> (!root) <span class="keyword">return</span> error(<span class="string">'#mocha div missing, add it to your document'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>pass toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  on(passesLink, <span class="string">'click'</span>, <span class="keyword">function</span>(){
    unhide();
    <span class="keyword">var</span> name = <span class="regexp">/pass/</span>.test(report.className) ? <span class="string">''</span> : <span class="string">' pass'</span>;
    report.className = report.className.replace(<span class="regexp">/fail|pass/g</span>, <span class="string">''</span>) + name;
    <span class="keyword">if</span> (report.className.trim()) hideSuitesWithout(<span class="string">'test pass'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>failure toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  on(failuresLink, <span class="string">'click'</span>, <span class="keyword">function</span>(){
    unhide();
    <span class="keyword">var</span> name = <span class="regexp">/fail/</span>.test(report.className) ? <span class="string">''</span> : <span class="string">' fail'</span>;
    report.className = report.className.replace(<span class="regexp">/fail|pass/g</span>, <span class="string">''</span>) + name;
    <span class="keyword">if</span> (report.className.trim()) hideSuitesWithout(<span class="string">'test fail'</span>);
  });

  root.appendChild(stat);
  root.appendChild(report);

  <span class="keyword">if</span> (progress) progress.size(<span class="number">40</span>);

  runner.on(<span class="string">'suite'</span>, <span class="keyword">function</span>(suite){
    <span class="keyword">if</span> (suite.root) <span class="keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>suite</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> url = <span class="string">'?grep='</span> + encodeURIComponent(suite.fullTitle());
    <span class="keyword">var</span> el = fragment(<span class="string">'&lt;li class="suite"&gt;&lt;h1&gt;&lt;a href="%s"&gt;%s&lt;/a&gt;&lt;/h1&gt;&lt;/li&gt;'</span>, url, escape(suite.title));</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stack[<span class="number">0</span>].appendChild(el);
    stack.unshift(document.createElement(<span class="string">'ul'</span>));
    el.appendChild(stack[<span class="number">0</span>]);
  });

  runner.on(<span class="string">'suite end'</span>, <span class="keyword">function</span>(suite){
    <span class="keyword">if</span> (suite.root) <span class="keyword">return</span>;
    stack.shift();
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    <span class="keyword">if</span> (<span class="string">'hook'</span> == test.type) runner.emit(<span class="string">'test end'</span>, test);
  });

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test){</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>TODO: add to stats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> percent = stats.tests / <span class="keyword">this</span>.total * <span class="number">100</span> | <span class="number">0</span>;
    <span class="keyword">if</span> (progress) progress.update(percent).draw(ctx);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>update stats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> ms = <span class="keyword">new</span> Date - stats.start;
    text(passes, stats.passes);
    text(failures, stats.failures);
    text(duration, (ms / <span class="number">1000</span>).toFixed(<span class="number">2</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="string">'passed'</span> == test.state) {
      <span class="keyword">var</span> el = fragment(<span class="string">'&lt;li class="test pass %e"&gt;&lt;h2&gt;%e&lt;span class="duration"&gt;%ems&lt;/span&gt; &lt;a href="?grep=%e" class="replay"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;/li&gt;'</span>, test.speed, test.title, test.duration, encodeURIComponent(test.fullTitle()));
    } <span class="keyword">else</span> <span class="keyword">if</span> (test.pending) {
      <span class="keyword">var</span> el = fragment(<span class="string">'&lt;li class="test pass pending"&gt;&lt;h2&gt;%e&lt;/h2&gt;&lt;/li&gt;'</span>, test.title);
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> el = fragment(<span class="string">'&lt;li class="test fail"&gt;&lt;h2&gt;%e &lt;a href="?grep=%e" class="replay"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;/li&gt;'</span>, test.title, encodeURIComponent(test.fullTitle()));
      <span class="keyword">var</span> str = test.err.stack || test.err.toString();</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>FF / Opera do not add the message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (!~str.indexOf(test.err.message)) {
        str = test.err.message + <span class="string">'\n'</span> + str;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>&lt;=IE7 stringifies to [Object Error]. Since it can be overloaded, we
check for the result of the stringifying.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (<span class="string">'[object Error]'</span> == str) str = test.err.message;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Safari doesn&#39;t give you a stack. Let&#39;s at least provide a source line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (!test.err.stack &amp;&amp; test.err.sourceURL &amp;&amp; test.err.line !== <span class="literal">undefined</span>) {
        str += <span class="string">"\n("</span> + test.err.sourceURL + <span class="string">":"</span> + test.err.line + <span class="string">")"</span>;
      }

      el.appendChild(fragment(<span class="string">'&lt;pre class="error"&gt;%e&lt;/pre&gt;'</span>, str));
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>toggle code
TODO: defer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!test.pending) {
      <span class="keyword">var</span> h2 = el.getElementsByTagName(<span class="string">'h2'</span>)[<span class="number">0</span>];

      on(h2, <span class="string">'click'</span>, <span class="keyword">function</span>(){
        pre.style.display = <span class="string">'none'</span> == pre.style.display
          ? <span class="string">'block'</span>
          : <span class="string">'none'</span>;
      });

      <span class="keyword">var</span> pre = fragment(<span class="string">'&lt;pre&gt;&lt;code&gt;%e&lt;/code&gt;&lt;/pre&gt;'</span>, utils.clean(test.fn.toString()));
      el.appendChild(pre);
      pre.style.display = <span class="string">'none'</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Don&#39;t call .appendChild if #mocha-report was already .shift()&#39;ed off the stack.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (stack[<span class="number">0</span>]) stack[<span class="number">0</span>].appendChild(el);
  });
}

<span class="comment">/**
 * Display error `msg`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">error</span><span class="params">(msg)</span> {</span>
  document.body.appendChild(fragment(<span class="string">'&lt;div id="mocha-error"&gt;%s&lt;/div&gt;'</span>, msg));
}

<span class="comment">/**
 * Return a DOM fragment from `html`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">fragment</span><span class="params">(html)</span> {</span>
  <span class="keyword">var</span> args = arguments
    , div = document.createElement(<span class="string">'div'</span>)
    , i = <span class="number">1</span>;

  div.innerHTML = html.replace(<span class="regexp">/%([se])/g</span>, <span class="keyword">function</span>(_, type){
    <span class="keyword">switch</span> (type) {
      <span class="keyword">case</span> <span class="string">'s'</span>: <span class="keyword">return</span> String(args[i++]);
      <span class="keyword">case</span> <span class="string">'e'</span>: <span class="keyword">return</span> escape(args[i++]);
    }
  });

  <span class="keyword">return</span> div.firstChild;
}

<span class="comment">/**
 * Check for suites that do not have elements
 * with `classname`, and hide them.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">hideSuitesWithout</span><span class="params">(classname)</span> {</span>
  <span class="keyword">var</span> suites = document.getElementsByClassName(<span class="string">'suite'</span>);
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; suites.length; i++) {
    <span class="keyword">var</span> els = suites[i].getElementsByClassName(classname);
    <span class="keyword">if</span> (<span class="number">0</span> == els.length) suites[i].className += <span class="string">' hidden'</span>;
  }
}

<span class="comment">/**
 * Unhide .hidden suites.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">unhide</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> els = document.getElementsByClassName(<span class="string">'suite hidden'</span>);
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; els.length; ++i) {
    els[i].className = els[i].className.replace(<span class="string">'suite hidden'</span>, <span class="string">'suite'</span>);
  }
}

<span class="comment">/**
 * Set `el` text to `str`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">text</span><span class="params">(el, str)</span> {</span>
  <span class="keyword">if</span> (el.textContent) {
    el.textContent = str;
  } <span class="keyword">else</span> {
    el.innerText = str;
  }
}

<span class="comment">/**
 * Listen on `event` with callback `fn`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">(el, event, fn)</span> {</span>
  <span class="keyword">if</span> (el.addEventListener) {
    el.addEventListener(event, fn, <span class="literal">false</span>);
  } <span class="keyword">else</span> {
    el.attachEvent(<span class="string">'on'</span> + event, fn);
  }
}

}); <span class="comment">// module: reporters/html.js</span>

require.register(<span class="string">"reporters/index.js"</span>, <span class="keyword">function</span>(module, exports, require){

exports.Base = require(<span class="string">'./base'</span>);
exports.Dot = require(<span class="string">'./dot'</span>);
exports.Doc = require(<span class="string">'./doc'</span>);
exports.TAP = require(<span class="string">'./tap'</span>);
exports.JSON = require(<span class="string">'./json'</span>);
exports.HTML = require(<span class="string">'./html'</span>);
exports.List = require(<span class="string">'./list'</span>);
exports.Min = require(<span class="string">'./min'</span>);
exports.Spec = require(<span class="string">'./spec'</span>);
exports.Nyan = require(<span class="string">'./nyan'</span>);
exports.XUnit = require(<span class="string">'./xunit'</span>);
exports.Markdown = require(<span class="string">'./markdown'</span>);
exports.Progress = require(<span class="string">'./progress'</span>);
exports.Landing = require(<span class="string">'./landing'</span>);
exports.JSONCov = require(<span class="string">'./json-cov'</span>);
exports.HTMLCov = require(<span class="string">'./html-cov'</span>);
exports.JSONStream = require(<span class="string">'./json-stream'</span>);
exports.Teamcity = require(<span class="string">'./teamcity'</span>);

}); <span class="comment">// module: reporters/index.js</span>

require.register(<span class="string">"reporters/json-cov.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>);

<span class="comment">/**
 * Expose `JSONCov`.
 */</span>

exports = module.exports = JSONCov;

<span class="comment">/**
 * Initialize a new `JsCoverage` reporter.
 *
 * @param {Runner} runner
 * @param {Boolean} output
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">JSONCov</span><span class="params">(runner, output)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , output = <span class="number">1</span> == arguments.length ? <span class="literal">true</span> : output;

  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> tests = []
    , failures = []
    , passes = [];

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test){
    tests.push(test);
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    passes.push(test);
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test){
    failures.push(test);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    <span class="keyword">var</span> cov = global._$jscoverage || {};
    <span class="keyword">var</span> result = self.cov = map(cov);
    result.stats = self.stats;
    result.tests = tests.map(clean);
    result.failures = failures.map(clean);
    result.passes = passes.map(clean);
    <span class="keyword">if</span> (!output) <span class="keyword">return</span>;
    process.stdout.write(JSON.stringify(result, <span class="literal">null</span>, <span class="number">2</span> ));
  });
}

<span class="comment">/**
 * Map jscoverage data to a JSON structure
 * suitable for reporting.
 *
 * @param {Object} cov
 * @return {Object}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">map</span><span class="params">(cov)</span> {</span>
  <span class="keyword">var</span> ret = {
      instrumentation: <span class="string">'node-jscoverage'</span>
    , sloc: <span class="number">0</span>
    , hits: <span class="number">0</span>
    , misses: <span class="number">0</span>
    , coverage: <span class="number">0</span>
    , files: []
  };

  <span class="keyword">for</span> (<span class="keyword">var</span> filename <span class="keyword">in</span> cov) {
    <span class="keyword">var</span> data = coverage(filename, cov[filename]);
    ret.files.push(data);
    ret.hits += data.hits;
    ret.misses += data.misses;
    ret.sloc += data.sloc;
  }

  ret.files.sort(<span class="keyword">function</span>(a, b) {
    <span class="keyword">return</span> a.filename.localeCompare(b.filename);
  });

  <span class="keyword">if</span> (ret.sloc &gt; <span class="number">0</span>) {
    ret.coverage = (ret.hits / ret.sloc) * <span class="number">100</span>;
  }

  <span class="keyword">return</span> ret;
};

<span class="comment">/**
 * Map jscoverage data for a single source file
 * to a JSON structure suitable for reporting.
 *
 * @param {String} filename name of the source file
 * @param {Object} data jscoverage coverage data
 * @return {Object}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">coverage</span><span class="params">(filename, data)</span> {</span>
  <span class="keyword">var</span> ret = {
    filename: filename,
    coverage: <span class="number">0</span>,
    hits: <span class="number">0</span>,
    misses: <span class="number">0</span>,
    sloc: <span class="number">0</span>,
    source: {}
  };

  data.source.forEach(<span class="keyword">function</span>(line, num){
    num++;

    <span class="keyword">if</span> (data[num] === <span class="number">0</span>) {
      ret.misses++;
      ret.sloc++;
    } <span class="keyword">else</span> <span class="keyword">if</span> (data[num] !== <span class="literal">undefined</span>) {
      ret.hits++;
      ret.sloc++;
    }

    ret.source[num] = {
        source: line
      , coverage: data[num] === <span class="literal">undefined</span>
        ? <span class="string">''</span>
        : data[num]
    };
  });

  ret.coverage = ret.hits / ret.sloc * <span class="number">100</span>;

  <span class="keyword">return</span> ret;
}

<span class="comment">/**
 * Return a plain-object representation of `test`
 * free of cyclic properties etc.
 *
 * @param {Object} test
 * @return {Object}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">(test)</span> {</span>
  <span class="keyword">return</span> {
      title: test.title
    , fullTitle: test.fullTitle()
    , duration: test.duration
  }
}

}); <span class="comment">// module: reporters/json-cov.js</span>

require.register(<span class="string">"reporters/json-stream.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , color = Base.color;

<span class="comment">/**
 * Expose `List`.
 */</span>

exports = module.exports = List;

<span class="comment">/**
 * Initialize a new `List` test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">List</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , total = runner.total;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    console.log(JSON.stringify([<span class="string">'start'</span>, { total: total }]));
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    console.log(JSON.stringify([<span class="string">'pass'</span>, clean(test)]));
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    console.log(JSON.stringify([<span class="string">'fail'</span>, clean(test)]));
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    process.stdout.write(JSON.stringify([<span class="string">'end'</span>, self.stats]));
  });
}

<span class="comment">/**
 * Return a plain-object representation of `test`
 * free of cyclic properties etc.
 *
 * @param {Object} test
 * @return {Object}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">(test)</span> {</span>
  <span class="keyword">return</span> {
      title: test.title
    , fullTitle: test.fullTitle()
    , duration: test.duration
  }
}
}); <span class="comment">// module: reporters/json-stream.js</span>

require.register(<span class="string">"reporters/json.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="comment">/**
 * Expose `JSON`.
 */</span>

exports = module.exports = JSONReporter;

<span class="comment">/**
 * Initialize a new `JSON` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">JSONReporter</span><span class="params">(runner)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> tests = []
    , failures = []
    , passes = [];

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test){
    tests.push(test);
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    passes.push(test);
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test){
    failures.push(test);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    <span class="keyword">var</span> obj = {
        stats: self.stats
      , tests: tests.map(clean)
      , failures: failures.map(clean)
      , passes: passes.map(clean)
    };

    process.stdout.write(JSON.stringify(obj, <span class="literal">null</span>, <span class="number">2</span>));
  });
}

<span class="comment">/**
 * Return a plain-object representation of `test`
 * free of cyclic properties etc.
 *
 * @param {Object} test
 * @return {Object}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">(test)</span> {</span>
  <span class="keyword">return</span> {
      title: test.title
    , fullTitle: test.fullTitle()
    , duration: test.duration
  }
}
}); <span class="comment">// module: reporters/json.js</span>

require.register(<span class="string">"reporters/landing.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="comment">/**
 * Expose `Landing`.
 */</span>

exports = module.exports = Landing;

<span class="comment">/**
 * Airplane color.
 */</span>

Base.colors.plane = <span class="number">0</span>;

<span class="comment">/**
 * Airplane crash color.
 */</span>

Base.colors[<span class="string">'plane crash'</span>] = <span class="number">31</span>;

<span class="comment">/**
 * Runway color.
 */</span>

Base.colors.runway = <span class="number">90</span>;

<span class="comment">/**
 * Initialize a new `Landing` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Landing</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , width = Base.window.width * <span class="number">.75</span> | <span class="number">0</span>
    , total = runner.total
    , stream = process.stdout
    , plane = color(<span class="string">'plane'</span>, <span class="string">''</span>)
    , crashed = -<span class="number">1</span>
    , n = <span class="number">0</span>;

  <span class="function"><span class="keyword">function</span> <span class="title">runway</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> buf = Array(width).join(<span class="string">'-'</span>);
    <span class="keyword">return</span> <span class="string">'  '</span> + color(<span class="string">'runway'</span>, buf);
  }

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    stream.write(<span class="string">'\n  '</span>);
    cursor.hide();
  });

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test){</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>check if the plane crashed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> col = -<span class="number">1</span> == crashed
      ? width * ++n / total | <span class="number">0</span>
      : crashed;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>show the crash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="string">'failed'</span> == test.state) {
      plane = color(<span class="string">'plane crash'</span>, <span class="string">''</span>);
      crashed = col;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>render landing strip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stream.write(<span class="string">'\u001b[4F\n\n'</span>);
    stream.write(runway());
    stream.write(<span class="string">'\n  '</span>);
    stream.write(color(<span class="string">'runway'</span>, Array(col).join(<span class="string">''</span>)));
    stream.write(plane)
    stream.write(color(<span class="string">'runway'</span>, Array(width - col).join(<span class="string">''</span>) + <span class="string">'\n'</span>));
    stream.write(runway());
    stream.write(<span class="string">'\u001b[0m'</span>);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    cursor.show();
    console.log();
    self.epilogue();
  });
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
Landing.prototype = <span class="keyword">new</span> F;
Landing.prototype.constructor = Landing;

}); <span class="comment">// module: reporters/landing.js</span>

require.register(<span class="string">"reporters/list.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="comment">/**
 * Expose `List`.
 */</span>

exports = module.exports = List;

<span class="comment">/**
 * Initialize a new `List` test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">List</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , n = <span class="number">0</span>;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    console.log();
  });

  runner.on(<span class="string">'test'</span>, <span class="keyword">function</span>(test){
    process.stdout.write(color(<span class="string">'pass'</span>, <span class="string">'    '</span> + test.fullTitle() + <span class="string">': '</span>));
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(test){
    <span class="keyword">var</span> fmt = color(<span class="string">'checkmark'</span>, <span class="string">'  -'</span>)
      + color(<span class="string">'pending'</span>, <span class="string">' %s'</span>);
    console.log(fmt, test.fullTitle());
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    <span class="keyword">var</span> fmt = color(<span class="string">'checkmark'</span>, <span class="string">'  '</span>+Base.symbols.dot)
      + color(<span class="string">'pass'</span>, <span class="string">' %s: '</span>)
      + color(test.speed, <span class="string">'%dms'</span>);
    cursor.CR();
    console.log(fmt, test.fullTitle(), test.duration);
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    cursor.CR();
    console.log(color(<span class="string">'fail'</span>, <span class="string">'  %d) %s'</span>), ++n, test.fullTitle());
  });

  runner.on(<span class="string">'end'</span>, self.epilogue.bind(self));
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
List.prototype = <span class="keyword">new</span> F;
List.prototype.constructor = List;


}); <span class="comment">// module: reporters/list.js</span>

require.register(<span class="string">"reporters/markdown.js"</span>, <span class="keyword">function</span>(module, exports, require){
<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , utils = require(<span class="string">'../utils'</span>);

<span class="comment">/**
 * Expose `Markdown`.
 */</span>

exports = module.exports = Markdown;

<span class="comment">/**
 * Initialize a new `Markdown` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Markdown</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , level = <span class="number">0</span>
    , buf = <span class="string">''</span>;

  <span class="function"><span class="keyword">function</span> <span class="title">title</span><span class="params">(str)</span> {</span>
    <span class="keyword">return</span> Array(level).join(<span class="string">'#'</span>) + <span class="string">' '</span> + str;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">indent</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> Array(level).join(<span class="string">'  '</span>);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">mapTOC</span><span class="params">(suite, obj)</span> {</span>
    <span class="keyword">var</span> ret = obj;
    obj = obj[suite.title] = obj[suite.title] || { suite: suite };
    suite.suites.forEach(<span class="keyword">function</span>(suite){
      mapTOC(suite, obj);
    });
    <span class="keyword">return</span> ret;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">stringifyTOC</span><span class="params">(obj, level)</span> {</span>
    ++level;
    <span class="keyword">var</span> buf = <span class="string">''</span>;
    <span class="keyword">var</span> link;
    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
      <span class="keyword">if</span> (<span class="string">'suite'</span> == key) <span class="keyword">continue</span>;
      <span class="keyword">if</span> (key) link = <span class="string">' - ['</span> + key + <span class="string">'](#'</span> + utils.slug(obj[key].suite.fullTitle()) + <span class="string">')\n'</span>;
      <span class="keyword">if</span> (key) buf += Array(level).join(<span class="string">'  '</span>) + link;
      buf += stringifyTOC(obj[key], level);
    }
    --level;
    <span class="keyword">return</span> buf;
  }

  <span class="function"><span class="keyword">function</span> <span class="title">generateTOC</span><span class="params">(suite)</span> {</span>
    <span class="keyword">var</span> obj = mapTOC(suite, {});
    <span class="keyword">return</span> stringifyTOC(obj, <span class="number">0</span>);
  }

  generateTOC(runner.suite);

  runner.on(<span class="string">'suite'</span>, <span class="keyword">function</span>(suite){
    ++level;
    <span class="keyword">var</span> slug = utils.slug(suite.fullTitle());
    buf += <span class="string">'&lt;a name="'</span> + slug + <span class="string">'"&gt;&lt;/a&gt;'</span> + <span class="string">'\n'</span>;
    buf += title(suite.title) + <span class="string">'\n'</span>;
  });

  runner.on(<span class="string">'suite end'</span>, <span class="keyword">function</span>(suite){
    --level;
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    <span class="keyword">var</span> code = utils.clean(test.fn.toString());
    buf += test.title + <span class="string">'.\n'</span>;
    buf += <span class="string">'\n```js\n'</span>;
    buf += code + <span class="string">'\n'</span>;
    buf += <span class="string">'```\n\n'</span>;
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    process.stdout.write(<span class="string">'# TOC\n'</span>);
    process.stdout.write(generateTOC(runner.suite));
    process.stdout.write(buf);
  });
}
}); <span class="comment">// module: reporters/markdown.js</span>

require.register(<span class="string">"reporters/min.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>);

<span class="comment">/**
 * Expose `Min`.
 */</span>

exports = module.exports = Min;

<span class="comment">/**
 * Initialize a new `Min` minimal test reporter (best used with --watch).
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Min</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>clear screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    process.stdout.write(<span class="string">'\u001b[2J'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>set cursor position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    process.stdout.write(<span class="string">'\u001b[1;3H'</span>);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">this</span>.epilogue.bind(<span class="keyword">this</span>));
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
Min.prototype = <span class="keyword">new</span> F;
Min.prototype.constructor = Min;


}); <span class="comment">// module: reporters/min.js</span>

require.register(<span class="string">"reporters/nyan.js"</span>, <span class="keyword">function</span>(module, exports, require){
<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , color = Base.color;

<span class="comment">/**
 * Expose `Dot`.
 */</span>

exports = module.exports = NyanCat;

<span class="comment">/**
 * Initialize a new `Dot` matrix test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">NyanCat</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , width = Base.window.width * <span class="number">.75</span> | <span class="number">0</span>
    , rainbowColors = <span class="keyword">this</span>.rainbowColors = self.generateColors()
    , colorIndex = <span class="keyword">this</span>.colorIndex = <span class="number">0</span>
    , numerOfLines = <span class="keyword">this</span>.numberOfLines = <span class="number">4</span>
    , trajectories = <span class="keyword">this</span>.trajectories = [[], [], [], []]
    , nyanCatWidth = <span class="keyword">this</span>.nyanCatWidth = <span class="number">11</span>
    , trajectoryWidthMax = <span class="keyword">this</span>.trajectoryWidthMax = (width - nyanCatWidth)
    , scoreboardWidth = <span class="keyword">this</span>.scoreboardWidth = <span class="number">5</span>
    , tick = <span class="keyword">this</span>.tick = <span class="number">0</span>
    , n = <span class="number">0</span>;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    Base.cursor.hide();
    self.draw(<span class="string">'start'</span>);
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(test){
    self.draw(<span class="string">'pending'</span>);
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    self.draw(<span class="string">'pass'</span>);
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    self.draw(<span class="string">'fail'</span>);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    Base.cursor.show();
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; self.numberOfLines; i++) write(<span class="string">'\n'</span>);
    self.epilogue();
  });
}

<span class="comment">/**
 * Draw the nyan cat with runner `status`.
 *
 * @param {String} status
 * @api private
 */</span>

NyanCat.prototype.draw = <span class="keyword">function</span>(status){
  <span class="keyword">this</span>.appendRainbow();
  <span class="keyword">this</span>.drawScoreboard();
  <span class="keyword">this</span>.drawRainbow();
  <span class="keyword">this</span>.drawNyanCat(status);
  <span class="keyword">this</span>.tick = !<span class="keyword">this</span>.tick;
};

<span class="comment">/**
 * Draw the "scoreboard" showing the number
 * of passes, failures and pending tests.
 *
 * @api private
 */</span>

NyanCat.prototype.drawScoreboard = <span class="keyword">function</span>(){
  <span class="keyword">var</span> stats = <span class="keyword">this</span>.stats;
  <span class="keyword">var</span> colors = Base.colors;

  <span class="function"><span class="keyword">function</span> <span class="title">draw</span><span class="params">(color, n)</span> {</span>
    write(<span class="string">' '</span>);
    write(<span class="string">'\u001b['</span> + color + <span class="string">'m'</span> + n + <span class="string">'\u001b[0m'</span>);
    write(<span class="string">'\n'</span>);
  }

  draw(colors.green, stats.passes);
  draw(colors.fail, stats.failures);
  draw(colors.pending, stats.pending);
  write(<span class="string">'\n'</span>);

  <span class="keyword">this</span>.cursorUp(<span class="keyword">this</span>.numberOfLines);
};

<span class="comment">/**
 * Append the rainbow.
 *
 * @api private
 */</span>

NyanCat.prototype.appendRainbow = <span class="keyword">function</span>(){
  <span class="keyword">var</span> segment = <span class="keyword">this</span>.tick ? <span class="string">'_'</span> : <span class="string">'-'</span>;
  <span class="keyword">var</span> rainbowified = <span class="keyword">this</span>.rainbowify(segment);

  <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; <span class="keyword">this</span>.numberOfLines; index++) {
    <span class="keyword">var</span> trajectory = <span class="keyword">this</span>.trajectories[index];
    <span class="keyword">if</span> (trajectory.length &gt;= <span class="keyword">this</span>.trajectoryWidthMax) trajectory.shift();
    trajectory.push(rainbowified);
  }
};

<span class="comment">/**
 * Draw the rainbow.
 *
 * @api private
 */</span>

NyanCat.prototype.drawRainbow = <span class="keyword">function</span>(){
  <span class="keyword">var</span> self = <span class="keyword">this</span>;

  <span class="keyword">this</span>.trajectories.forEach(<span class="keyword">function</span>(line, index) {
    write(<span class="string">'\u001b['</span> + self.scoreboardWidth + <span class="string">'C'</span>);
    write(line.join(<span class="string">''</span>));
    write(<span class="string">'\n'</span>);
  });

  <span class="keyword">this</span>.cursorUp(<span class="keyword">this</span>.numberOfLines);
};

<span class="comment">/**
 * Draw the nyan cat with `status`.
 *
 * @param {String} status
 * @api private
 */</span>

NyanCat.prototype.drawNyanCat = <span class="keyword">function</span>(status) {
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">var</span> startWidth = <span class="keyword">this</span>.scoreboardWidth + <span class="keyword">this</span>.trajectories[<span class="number">0</span>].length;
  <span class="keyword">var</span> color = <span class="string">'\u001b['</span> + startWidth + <span class="string">'C'</span>;
  <span class="keyword">var</span> padding = <span class="string">''</span>;
  
  write(color);
  write(<span class="string">'_,------,'</span>);
  write(<span class="string">'\n'</span>);
  
  write(color);
  padding = self.tick ? <span class="string">'  '</span> : <span class="string">'   '</span>;
  write(<span class="string">'_|'</span> + padding + <span class="string">'/\\_/\\ '</span>);
  write(<span class="string">'\n'</span>);
  
  write(color);
  padding = self.tick ? <span class="string">'_'</span> : <span class="string">'__'</span>;
  <span class="keyword">var</span> tail = self.tick ? <span class="string">'~'</span> : <span class="string">'^'</span>;
  <span class="keyword">var</span> face;
  <span class="keyword">switch</span> (status) {
    <span class="keyword">case</span> <span class="string">'pass'</span>:
      face = <span class="string">'( ^ .^)'</span>;
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'fail'</span>:
      face = <span class="string">'( o .o)'</span>;
      <span class="keyword">break</span>;
    <span class="keyword">default</span>:
      face = <span class="string">'( - .-)'</span>;
  }
  write(tail + <span class="string">'|'</span> + padding + face + <span class="string">' '</span>);
  write(<span class="string">'\n'</span>);
  
  write(color);
  padding = self.tick ? <span class="string">' '</span> : <span class="string">'  '</span>;
  write(padding + <span class="string">'""  "" '</span>);
  write(<span class="string">'\n'</span>);

  <span class="keyword">this</span>.cursorUp(<span class="keyword">this</span>.numberOfLines);
};

<span class="comment">/**
 * Move cursor up `n`.
 *
 * @param {Number} n
 * @api private
 */</span>

NyanCat.prototype.cursorUp = <span class="keyword">function</span>(n) {
  write(<span class="string">'\u001b['</span> + n + <span class="string">'A'</span>);
};

<span class="comment">/**
 * Move cursor down `n`.
 *
 * @param {Number} n
 * @api private
 */</span>

NyanCat.prototype.cursorDown = <span class="keyword">function</span>(n) {
  write(<span class="string">'\u001b['</span> + n + <span class="string">'B'</span>);
};

<span class="comment">/**
 * Generate rainbow colors.
 *
 * @return {Array}
 * @api private
 */</span>

NyanCat.prototype.generateColors = <span class="keyword">function</span>(){
  <span class="keyword">var</span> colors = [];

  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; (<span class="number">6</span> * <span class="number">7</span>); i++) {
    <span class="keyword">var</span> pi3 = Math.floor(Math.PI / <span class="number">3</span>);
    <span class="keyword">var</span> n = (i * (<span class="number">1.0</span> / <span class="number">6</span>));
    <span class="keyword">var</span> r = Math.floor(<span class="number">3</span> * Math.sin(n) + <span class="number">3</span>);
    <span class="keyword">var</span> g = Math.floor(<span class="number">3</span> * Math.sin(n + <span class="number">2</span> * pi3) + <span class="number">3</span>);
    <span class="keyword">var</span> b = Math.floor(<span class="number">3</span> * Math.sin(n + <span class="number">4</span> * pi3) + <span class="number">3</span>);
    colors.push(<span class="number">36</span> * r + <span class="number">6</span> * g + b + <span class="number">16</span>);
  }

  <span class="keyword">return</span> colors;
};

<span class="comment">/**
 * Apply rainbow to the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

NyanCat.prototype.rainbowify = <span class="keyword">function</span>(str){
  <span class="keyword">var</span> color = <span class="keyword">this</span>.rainbowColors[<span class="keyword">this</span>.colorIndex % <span class="keyword">this</span>.rainbowColors.length];
  <span class="keyword">this</span>.colorIndex += <span class="number">1</span>;
  <span class="keyword">return</span> <span class="string">'\u001b[38;5;'</span> + color + <span class="string">'m'</span> + str + <span class="string">'\u001b[0m'</span>;
};

<span class="comment">/**
 * Stdout helper.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">(string)</span> {</span>
  process.stdout.write(string);
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
NyanCat.prototype = <span class="keyword">new</span> F;
NyanCat.prototype.constructor = NyanCat;


}); <span class="comment">// module: reporters/nyan.js</span>

require.register(<span class="string">"reporters/progress.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="comment">/**
 * Expose `Progress`.
 */</span>

exports = module.exports = Progress;

<span class="comment">/**
 * General progress bar color.
 */</span>

Base.colors.progress = <span class="number">90</span>;

<span class="comment">/**
 * Initialize a new `Progress` bar test reporter.
 *
 * @param {Runner} runner
 * @param {Object} options
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Progress</span><span class="params">(runner, options)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , options = options || {}
    , stats = <span class="keyword">this</span>.stats
    , width = Base.window.width * <span class="number">.50</span> | <span class="number">0</span>
    , total = runner.total
    , complete = <span class="number">0</span>
    , max = Math.max;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>default chars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.open = options.open || <span class="string">'['</span>;
  options.complete = options.complete || <span class="string">''</span>;
  options.incomplete = options.incomplete || Base.symbols.dot;
  options.close = options.close || <span class="string">']'</span>;
  options.verbose = <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>tests started</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    console.log();
    cursor.hide();
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>tests complete</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(){
    complete++;
    <span class="keyword">var</span> incomplete = total - complete
      , percent = complete / total
      , n = width * percent | <span class="number">0</span>
      , i = width - n;

    cursor.CR();
    process.stdout.write(<span class="string">'\u001b[J'</span>);
    process.stdout.write(color(<span class="string">'progress'</span>, <span class="string">'  '</span> + options.open));
    process.stdout.write(Array(n).join(options.complete));
    process.stdout.write(Array(i).join(options.incomplete));
    process.stdout.write(color(<span class="string">'progress'</span>, options.close));
    <span class="keyword">if</span> (options.verbose) {
      process.stdout.write(color(<span class="string">'progress'</span>, <span class="string">' '</span> + complete + <span class="string">' of '</span> + total));
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>tests are complete, output some stats
and the failures if any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    cursor.show();
    console.log();
    self.epilogue();
  });
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
Progress.prototype = <span class="keyword">new</span> F;
Progress.prototype.constructor = Progress;


}); <span class="comment">// module: reporters/progress.js</span>

require.register(<span class="string">"reporters/spec.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="comment">/**
 * Expose `Spec`.
 */</span>

exports = module.exports = Spec;

<span class="comment">/**
 * Initialize a new `Spec` test reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Spec</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , indents = <span class="number">0</span>
    , n = <span class="number">0</span>;

  <span class="function"><span class="keyword">function</span> <span class="title">indent</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> Array(indents).join(<span class="string">'  '</span>)
  }

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    console.log();
  });

  runner.on(<span class="string">'suite'</span>, <span class="keyword">function</span>(suite){
    ++indents;
    console.log(color(<span class="string">'suite'</span>, <span class="string">'%s%s'</span>), indent(), suite.title);
  });

  runner.on(<span class="string">'suite end'</span>, <span class="keyword">function</span>(suite){
    --indents;
    <span class="keyword">if</span> (<span class="number">1</span> == indents) console.log();
  });

  runner.on(<span class="string">'test'</span>, <span class="keyword">function</span>(test){
    process.stdout.write(indent() + color(<span class="string">'pass'</span>, <span class="string">'   '</span> + test.title + <span class="string">': '</span>));
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(test){
    <span class="keyword">var</span> fmt = indent() + color(<span class="string">'pending'</span>, <span class="string">'  - %s'</span>);
    console.log(fmt, test.title);
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    <span class="keyword">if</span> (<span class="string">'fast'</span> == test.speed) {
      <span class="keyword">var</span> fmt = indent()
        + color(<span class="string">'checkmark'</span>, <span class="string">'  '</span> + Base.symbols.ok)
        + color(<span class="string">'pass'</span>, <span class="string">' %s '</span>);
      cursor.CR();
      console.log(fmt, test.title);
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> fmt = indent()
        + color(<span class="string">'checkmark'</span>, <span class="string">'  '</span> + Base.symbols.ok)
        + color(<span class="string">'pass'</span>, <span class="string">' %s '</span>)
        + color(test.speed, <span class="string">'(%dms)'</span>);
      cursor.CR();
      console.log(fmt, test.title, test.duration);
    }
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    cursor.CR();
    console.log(indent() + color(<span class="string">'fail'</span>, <span class="string">'  %d) %s'</span>), ++n, test.title);
  });

  runner.on(<span class="string">'end'</span>, self.epilogue.bind(self));
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
Spec.prototype = <span class="keyword">new</span> F;
Spec.prototype.constructor = Spec;


}); <span class="comment">// module: reporters/spec.js</span>

require.register(<span class="string">"reporters/tap.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , cursor = Base.cursor
  , color = Base.color;

<span class="comment">/**
 * Expose `TAP`.
 */</span>

exports = module.exports = TAP;

<span class="comment">/**
 * Initialize a new `TAP` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">TAP</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);

  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , stats = <span class="keyword">this</span>.stats
    , n = <span class="number">1</span>
    , passes = <span class="number">0</span>
    , failures = <span class="number">0</span>;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>(){
    <span class="keyword">var</span> total = runner.grepTotal(runner.suite);
    console.log(<span class="string">'%d..%d'</span>, <span class="number">1</span>, total);
  });

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(){
    ++n;
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(test){
    console.log(<span class="string">'ok %d %s # SKIP -'</span>, n, title(test));
  });

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    passes++;
    console.log(<span class="string">'ok %d %s'</span>, n, title(test));
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err){
    failures++;
    console.log(<span class="string">'not ok %d %s'</span>, n, title(test));
    <span class="keyword">if</span> (err.stack) console.log(err.stack.replace(<span class="regexp">/^/gm</span>, <span class="string">'  '</span>));
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    console.log(<span class="string">'# tests '</span> + (passes + failures));
    console.log(<span class="string">'# pass '</span> + passes);
    console.log(<span class="string">'# fail '</span> + failures);
  });
}

<span class="comment">/**
 * Return a TAP-safe title of `test`
 *
 * @param {Object} test
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">title</span><span class="params">(test)</span> {</span>
  <span class="keyword">return</span> test.fullTitle().replace(<span class="regexp">/#/g</span>, <span class="string">''</span>);
}

}); <span class="comment">// module: reporters/tap.js</span>

require.register(<span class="string">"reporters/teamcity.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>);

<span class="comment">/**
 * Expose `Teamcity`.
 */</span>

exports = module.exports = Teamcity;

<span class="comment">/**
 * Initialize a new `Teamcity` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Teamcity</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);
  <span class="keyword">var</span> stats = <span class="keyword">this</span>.stats;

  runner.on(<span class="string">'start'</span>, <span class="keyword">function</span>() {
    console.log(<span class="string">"##teamcity[testSuiteStarted name='mocha.suite']"</span>);
  });

  runner.on(<span class="string">'test'</span>, <span class="keyword">function</span>(test) {
    console.log(<span class="string">"##teamcity[testStarted name='"</span> + escape(test.fullTitle()) + <span class="string">"']"</span>);
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test, err) {
    console.log(<span class="string">"##teamcity[testFailed name='"</span> + escape(test.fullTitle()) + <span class="string">"' message='"</span> + escape(err.message) + <span class="string">"']"</span>);
  });

  runner.on(<span class="string">'pending'</span>, <span class="keyword">function</span>(test) {
    console.log(<span class="string">"##teamcity[testIgnored name='"</span> + escape(test.fullTitle()) + <span class="string">"' message='pending']"</span>);
  });

  runner.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test) {
    console.log(<span class="string">"##teamcity[testFinished name='"</span> + escape(test.fullTitle()) + <span class="string">"' duration='"</span> + test.duration + <span class="string">"']"</span>);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>() {
    console.log(<span class="string">"##teamcity[testSuiteFinished name='mocha.suite' duration='"</span> + stats.duration + <span class="string">"']"</span>);
  });
}

<span class="comment">/**
 * Escape the given `str`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(str)</span> {</span>
  <span class="keyword">return</span> str
    .replace(<span class="regexp">/\|/g</span>, <span class="string">"||"</span>)
    .replace(<span class="regexp">/\n/g</span>, <span class="string">"|n"</span>)
    .replace(<span class="regexp">/\r/g</span>, <span class="string">"|r"</span>)
    .replace(<span class="regexp">/\[/g</span>, <span class="string">"|["</span>)
    .replace(<span class="regexp">/\]/g</span>, <span class="string">"|]"</span>)
    .replace(<span class="regexp">/\u0085/g</span>, <span class="string">"|x"</span>)
    .replace(<span class="regexp">/\u2028/g</span>, <span class="string">"|l"</span>)
    .replace(<span class="regexp">/\u2029/g</span>, <span class="string">"|p"</span>)
    .replace(<span class="regexp">/'/g</span>, <span class="string">"|'"</span>);
}

}); <span class="comment">// module: reporters/teamcity.js</span>

require.register(<span class="string">"reporters/xunit.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Base = require(<span class="string">'./base'</span>)
  , utils = require(<span class="string">'../utils'</span>)
  , escape = utils.escape;

<span class="comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="keyword">var</span> Date = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="comment">/**
 * Expose `XUnit`.
 */</span>

exports = module.exports = XUnit;

<span class="comment">/**
 * Initialize a new `XUnit` reporter.
 *
 * @param {Runner} runner
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">XUnit</span><span class="params">(runner)</span> {</span>
  Base.call(<span class="keyword">this</span>, runner);
  <span class="keyword">var</span> stats = <span class="keyword">this</span>.stats
    , tests = []
    , self = <span class="keyword">this</span>;

  runner.on(<span class="string">'pass'</span>, <span class="keyword">function</span>(test){
    tests.push(test);
  });

  runner.on(<span class="string">'fail'</span>, <span class="keyword">function</span>(test){
    tests.push(test);
  });

  runner.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    console.log(tag(<span class="string">'testsuite'</span>, {
        name: <span class="string">'Mocha Tests'</span>
      , tests: stats.tests
      , failures: stats.failures
      , errors: stats.failures
      , skip: stats.tests - stats.failures - stats.passes
      , timestamp: (<span class="keyword">new</span> Date).toUTCString()
      , time: stats.duration / <span class="number">1000</span>
    }, <span class="literal">false</span>));

    tests.forEach(test);
    console.log(<span class="string">'&lt;/testsuite&gt;'</span>);
  });
}

<span class="comment">/**
 * Inherit from `Base.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Base.prototype;
XUnit.prototype = <span class="keyword">new</span> F;
XUnit.prototype.constructor = XUnit;


<span class="comment">/**
 * Output tag for the given `test.`
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">(test)</span> {</span>
  <span class="keyword">var</span> attrs = {
      classname: test.parent.fullTitle()
    , name: test.title
    , time: test.duration / <span class="number">1000</span>
  };

  <span class="keyword">if</span> (<span class="string">'failed'</span> == test.state) {
    <span class="keyword">var</span> err = test.err;
    attrs.message = escape(err.message);
    console.log(tag(<span class="string">'testcase'</span>, attrs, <span class="literal">false</span>, tag(<span class="string">'failure'</span>, attrs, <span class="literal">false</span>, cdata(err.stack))));
  } <span class="keyword">else</span> <span class="keyword">if</span> (test.pending) {
    console.log(tag(<span class="string">'testcase'</span>, attrs, <span class="literal">false</span>, tag(<span class="string">'skipped'</span>, {}, <span class="literal">true</span>)));
  } <span class="keyword">else</span> {
    console.log(tag(<span class="string">'testcase'</span>, attrs, <span class="literal">true</span>) );
  }
}

<span class="comment">/**
 * HTML tag helper.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">tag</span><span class="params">(name, attrs, close, content)</span> {</span>
  <span class="keyword">var</span> end = close ? <span class="string">'/&gt;'</span> : <span class="string">'&gt;'</span>
    , pairs = []
    , tag;

  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> attrs) {
    pairs.push(key + <span class="string">'="'</span> + escape(attrs[key]) + <span class="string">'"'</span>);
  }

  tag = <span class="string">'&lt;'</span> + name + (pairs.length ? <span class="string">' '</span> + pairs.join(<span class="string">' '</span>) : <span class="string">''</span>) + end;
  <span class="keyword">if</span> (content) tag += content + <span class="string">'&lt;/'</span> + name + end;
  <span class="keyword">return</span> tag;
}

<span class="comment">/**
 * Return cdata escaped CDATA `str`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">cdata</span><span class="params">(str)</span> {</span>
  <span class="keyword">return</span> <span class="string">'&lt;![CDATA['</span> + escape(str) + <span class="string">']]&gt;'</span>;
}

}); <span class="comment">// module: reporters/xunit.js</span>

require.register(<span class="string">"runnable.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> EventEmitter = require(<span class="string">'browser/events'</span>).EventEmitter
  , debug = require(<span class="string">'browser/debug'</span>)(<span class="string">'mocha:runnable'</span>)
  , milliseconds = require(<span class="string">'./ms'</span>);

<span class="comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="keyword">var</span> Date = global.Date
  , setTimeout = global.setTimeout
  , setInterval = global.setInterval
  , clearTimeout = global.clearTimeout
  , clearInterval = global.clearInterval;

<span class="comment">/**
 * Object#toString().
 */</span>

<span class="keyword">var</span> toString = Object.prototype.toString;

<span class="comment">/**
 * Expose `Runnable`.
 */</span>

module.exports = Runnable;

<span class="comment">/**
 * Initialize a new `Runnable` with the given `title` and callback `fn`.
 *
 * @param {String} title
 * @param {Function} fn
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Runnable</span><span class="params">(title, fn)</span> {</span>
  <span class="keyword">this</span>.title = title;
  <span class="keyword">this</span>.fn = fn;
  <span class="keyword">this</span>.async = fn &amp;&amp; fn.length;
  <span class="keyword">this</span>.sync = ! <span class="keyword">this</span>.async;
  <span class="keyword">this</span>._timeout = <span class="number">2000</span>;
  <span class="keyword">this</span>._slow = <span class="number">75</span>;
  <span class="keyword">this</span>.timedOut = <span class="literal">false</span>;
}

<span class="comment">/**
 * Inherit from `EventEmitter.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = EventEmitter.prototype;
Runnable.prototype = <span class="keyword">new</span> F;
Runnable.prototype.constructor = Runnable;


<span class="comment">/**
 * Set &amp; get timeout `ms`.
 *
 * @param {Number|String} ms
 * @return {Runnable|Number} ms or self
 * @api private
 */</span>

Runnable.prototype.timeout = <span class="keyword">function</span>(ms){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._timeout;
  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> ms) ms = milliseconds(ms);
  debug(<span class="string">'timeout %d'</span>, ms);
  <span class="keyword">this</span>._timeout = ms;
  <span class="keyword">if</span> (<span class="keyword">this</span>.timer) <span class="keyword">this</span>.resetTimeout();
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set &amp; get slow `ms`.
 *
 * @param {Number|String} ms
 * @return {Runnable|Number} ms or self
 * @api private
 */</span>

Runnable.prototype.slow = <span class="keyword">function</span>(ms){
  <span class="keyword">if</span> (<span class="number">0</span> === arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._slow;
  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> ms) ms = milliseconds(ms);
  debug(<span class="string">'timeout %d'</span>, ms);
  <span class="keyword">this</span>._slow = ms;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Return the full title generated by recursively
 * concatenating the parent's full title.
 *
 * @return {String}
 * @api public
 */</span>

Runnable.prototype.fullTitle = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="keyword">this</span>.parent.fullTitle() + <span class="string">' '</span> + <span class="keyword">this</span>.title;
};

<span class="comment">/**
 * Clear the timeout.
 *
 * @api private
 */</span>

Runnable.prototype.clearTimeout = <span class="keyword">function</span>(){
  clearTimeout(<span class="keyword">this</span>.timer);
};

<span class="comment">/**
 * Inspect the runnable void of private properties.
 *
 * @return {String}
 * @api private
 */</span>

Runnable.prototype.inspect = <span class="keyword">function</span>(){
  <span class="keyword">return</span> JSON.stringify(<span class="keyword">this</span>, <span class="keyword">function</span>(key, val){
    <span class="keyword">if</span> (<span class="string">'_'</span> == key[<span class="number">0</span>]) <span class="keyword">return</span>;
    <span class="keyword">if</span> (<span class="string">'parent'</span> == key) <span class="keyword">return</span> <span class="string">'#&lt;Suite&gt;'</span>;
    <span class="keyword">if</span> (<span class="string">'ctx'</span> == key) <span class="keyword">return</span> <span class="string">'#&lt;Context&gt;'</span>;
    <span class="keyword">return</span> val;
  }, <span class="number">2</span>);
};

<span class="comment">/**
 * Reset the timeout.
 *
 * @api private
 */</span>

Runnable.prototype.resetTimeout = <span class="keyword">function</span>(){
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , ms = <span class="keyword">this</span>.timeout();

  <span class="keyword">this</span>.clearTimeout();
  <span class="keyword">if</span> (ms) {
    <span class="keyword">this</span>.timer = setTimeout(<span class="keyword">function</span>(){
      self.callback(<span class="keyword">new</span> Error(<span class="string">'timeout of '</span> + ms + <span class="string">'ms exceeded'</span>));
      self.timedOut = <span class="literal">true</span>;
    }, ms);
  }
};

<span class="comment">/**
 * Run the test and invoke `fn(err)`.
 *
 * @param {Function} fn
 * @api private
 */</span>

Runnable.prototype.run = <span class="keyword">function</span>(fn){
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , ms = <span class="keyword">this</span>.timeout()
    , start = <span class="keyword">new</span> Date
    , ctx = <span class="keyword">this</span>.ctx
    , finished
    , emitted;

  <span class="keyword">if</span> (ctx) ctx.runnable(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>timeout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (<span class="keyword">this</span>.async) {
    <span class="keyword">if</span> (ms) {
      <span class="keyword">this</span>.timer = setTimeout(<span class="keyword">function</span>(){
        done(<span class="keyword">new</span> Error(<span class="string">'timeout of '</span> + ms + <span class="string">'ms exceeded'</span>));
        self.timedOut = <span class="literal">true</span>;
      }, ms);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>called multiple times</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">multiple</span><span class="params">(err)</span> {</span>
    <span class="keyword">if</span> (emitted) <span class="keyword">return</span>;
    emitted = <span class="literal">true</span>;
    self.emit(<span class="string">'error'</span>, err || <span class="keyword">new</span> Error(<span class="string">'done() called multiple times'</span>));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>finished</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">done</span><span class="params">(err)</span> {</span>
    <span class="keyword">if</span> (self.timedOut) <span class="keyword">return</span>;
    <span class="keyword">if</span> (finished) <span class="keyword">return</span> multiple(err);
    self.clearTimeout();
    self.duration = <span class="keyword">new</span> Date - start;
    finished = <span class="literal">true</span>;
    fn(err);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>for .resetTimeout()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.callback = done;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>async</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (<span class="keyword">this</span>.async) {
    <span class="keyword">try</span> {
      <span class="keyword">this</span>.fn.call(ctx, <span class="keyword">function</span>(err){
        <span class="keyword">if</span> (err <span class="keyword">instanceof</span> Error || toString.call(err) === <span class="string">"[object Error]"</span>) <span class="keyword">return</span> done(err);
        <span class="keyword">if</span> (<span class="literal">null</span> != err) <span class="keyword">return</span> done(<span class="keyword">new</span> Error(<span class="string">'done() invoked with non-Error: '</span> + err));
        done();
      });
    } <span class="keyword">catch</span> (err) {
      done(err);
    }
    <span class="keyword">return</span>;
  }

  <span class="keyword">if</span> (<span class="keyword">this</span>.asyncOnly) {
    <span class="keyword">return</span> done(<span class="keyword">new</span> Error(<span class="string">'--async-only option in use without declaring `done()`'</span>));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>sync</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">try</span> {
    <span class="keyword">if</span> (!<span class="keyword">this</span>.pending) <span class="keyword">this</span>.fn.call(ctx);
    <span class="keyword">this</span>.duration = <span class="keyword">new</span> Date - start;
    fn();
  } <span class="keyword">catch</span> (err) {
    fn(err);
  }
};

}); <span class="comment">// module: runnable.js</span>

require.register(<span class="string">"runner.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> EventEmitter = require(<span class="string">'browser/events'</span>).EventEmitter
  , debug = require(<span class="string">'browser/debug'</span>)(<span class="string">'mocha:runner'</span>)
  , Test = require(<span class="string">'./test'</span>)
  , utils = require(<span class="string">'./utils'</span>)
  , filter = utils.filter
  , keys = utils.keys;

<span class="comment">/**
 * Non-enumerable globals.
 */</span>

<span class="keyword">var</span> globals = [
  <span class="string">'setTimeout'</span>,
  <span class="string">'clearTimeout'</span>,
  <span class="string">'setInterval'</span>,
  <span class="string">'clearInterval'</span>,
  <span class="string">'XMLHttpRequest'</span>,
  <span class="string">'Date'</span>
];

<span class="comment">/**
 * Expose `Runner`.
 */</span>

module.exports = Runner;

<span class="comment">/**
 * Initialize a `Runner` for the given `suite`.
 *
 * Events:
 *
 *   - `start`  execution started
 *   - `end`  execution complete
 *   - `suite`  (suite) test suite execution started
 *   - `suite end`  (suite) all tests (and sub-suites) have finished
 *   - `test`  (test) test execution started
 *   - `test end`  (test) test completed
 *   - `hook`  (hook) hook execution started
 *   - `hook end`  (hook) hook complete
 *   - `pass`  (test) test passed
 *   - `fail`  (test, err) test failed
 *
 * @api public
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Runner</span><span class="params">(suite)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">this</span>._globals = [];
  <span class="keyword">this</span>.suite = suite;
  <span class="keyword">this</span>.total = suite.total();
  <span class="keyword">this</span>.failures = <span class="number">0</span>;
  <span class="keyword">this</span>.on(<span class="string">'test end'</span>, <span class="keyword">function</span>(test){ self.checkGlobals(test); });
  <span class="keyword">this</span>.on(<span class="string">'hook end'</span>, <span class="keyword">function</span>(hook){ self.checkGlobals(hook); });
  <span class="keyword">this</span>.grep(<span class="regexp">/.*/</span>);
  <span class="keyword">this</span>.globals(<span class="keyword">this</span>.globalProps().concat([<span class="string">'errno'</span>]));
}

<span class="comment">/**
 * Wrapper for setImmediate, process.nextTick, or browser polyfill.
 *
 * @param {Function} fn
 * @api private
 */</span>

Runner.immediately = global.setImmediate || process.nextTick;

<span class="comment">/**
 * Inherit from `EventEmitter.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = EventEmitter.prototype;
Runner.prototype = <span class="keyword">new</span> F;
Runner.prototype.constructor = Runner;


<span class="comment">/**
 * Run tests with full titles matching `re`. Updates runner.total
 * with number of tests matched.
 *
 * @param {RegExp} re
 * @param {Boolean} invert
 * @return {Runner} for chaining
 * @api public
 */</span>

Runner.prototype.grep = <span class="keyword">function</span>(re, invert){
  debug(<span class="string">'grep %s'</span>, re);
  <span class="keyword">this</span>._grep = re;
  <span class="keyword">this</span>._invert = invert;
  <span class="keyword">this</span>.total = <span class="keyword">this</span>.grepTotal(<span class="keyword">this</span>.suite);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Returns the number of tests matching the grep search for the
 * given suite.
 *
 * @param {Suite} suite
 * @return {Number}
 * @api public
 */</span>

Runner.prototype.grepTotal = <span class="keyword">function</span>(suite) {
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">var</span> total = <span class="number">0</span>;

  suite.eachTest(<span class="keyword">function</span>(test){
    <span class="keyword">var</span> match = self._grep.test(test.fullTitle());
    <span class="keyword">if</span> (self._invert) match = !match;
    <span class="keyword">if</span> (match) total++;
  });

  <span class="keyword">return</span> total;
};

<span class="comment">/**
 * Return a list of global properties.
 *
 * @return {Array}
 * @api private
 */</span>

Runner.prototype.globalProps = <span class="keyword">function</span>() {
  <span class="keyword">var</span> props = utils.keys(global);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>non-enumerables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; globals.length; ++i) {
    <span class="keyword">if</span> (~utils.indexOf(props, globals[i])) <span class="keyword">continue</span>;
    props.push(globals[i]);
  }

  <span class="keyword">return</span> props;
};

<span class="comment">/**
 * Allow the given `arr` of globals.
 *
 * @param {Array} arr
 * @return {Runner} for chaining
 * @api public
 */</span>

Runner.prototype.globals = <span class="keyword">function</span>(arr){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._globals;
  debug(<span class="string">'globals %j'</span>, arr);
  utils.forEach(arr, <span class="keyword">function</span>(arr){
    <span class="keyword">this</span>._globals.push(arr);
  }, <span class="keyword">this</span>);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Check for global variable leaks.
 *
 * @api private
 */</span>

Runner.prototype.checkGlobals = <span class="keyword">function</span>(test){
  <span class="keyword">if</span> (<span class="keyword">this</span>.ignoreLeaks) <span class="keyword">return</span>;
  <span class="keyword">var</span> ok = <span class="keyword">this</span>._globals;
  <span class="keyword">var</span> globals = <span class="keyword">this</span>.globalProps();
  <span class="keyword">var</span> isNode = process.kill;
  <span class="keyword">var</span> leaks;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>check length - 2 (&#39;errno&#39; and &#39;location&#39; globals)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (isNode &amp;&amp; <span class="number">1</span> == ok.length - globals.length) <span class="keyword">return</span>
  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">2</span> == ok.length - globals.length) <span class="keyword">return</span>;

  leaks = filterLeaks(ok, globals);
  <span class="keyword">this</span>._globals = <span class="keyword">this</span>._globals.concat(leaks);

  <span class="keyword">if</span> (leaks.length &gt; <span class="number">1</span>) {
    <span class="keyword">this</span>.fail(test, <span class="keyword">new</span> Error(<span class="string">'global leaks detected: '</span> + leaks.join(<span class="string">', '</span>) + <span class="string">''</span>));
  } <span class="keyword">else</span> <span class="keyword">if</span> (leaks.length) {
    <span class="keyword">this</span>.fail(test, <span class="keyword">new</span> Error(<span class="string">'global leak detected: '</span> + leaks[<span class="number">0</span>]));
  }
};

<span class="comment">/**
 * Fail the given `test`.
 *
 * @param {Test} test
 * @param {Error} err
 * @api private
 */</span>

Runner.prototype.fail = <span class="keyword">function</span>(test, err){
  ++<span class="keyword">this</span>.failures;
  test.state = <span class="string">'failed'</span>;

  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> err) {
    err = <span class="keyword">new</span> Error(<span class="string">'the string "'</span> + err + <span class="string">'" was thrown, throw an Error :)'</span>);
  }

  <span class="keyword">this</span>.emit(<span class="string">'fail'</span>, test, err);
};

<span class="comment">/**
 * Fail the given `hook` with `err`.
 *
 * Hook failures (currently) hard-end due
 * to that fact that a failing hook will
 * surely cause subsequent tests to fail,
 * causing jumbled reporting.
 *
 * @param {Hook} hook
 * @param {Error} err
 * @api private
 */</span>

Runner.prototype.failHook = <span class="keyword">function</span>(hook, err){
  <span class="keyword">this</span>.fail(hook, err);
  <span class="keyword">this</span>.emit(<span class="string">'end'</span>);
};

<span class="comment">/**
 * Run hook `name` callbacks and then invoke `fn()`.
 *
 * @param {String} name
 * @param {Function} function
 * @api private
 */</span>

Runner.prototype.hook = <span class="keyword">function</span>(name, fn){
  <span class="keyword">var</span> suite = <span class="keyword">this</span>.suite
    , hooks = suite[<span class="string">'_'</span> + name]
    , self = <span class="keyword">this</span>
    , timer;

  <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">(i)</span> {</span>
    <span class="keyword">var</span> hook = hooks[i];
    <span class="keyword">if</span> (!hook) <span class="keyword">return</span> fn();
    self.currentRunnable = hook;

    self.emit(<span class="string">'hook'</span>, hook);

    hook.on(<span class="string">'error'</span>, <span class="keyword">function</span>(err){
      self.failHook(hook, err);
    });

    hook.run(<span class="keyword">function</span>(err){
      hook.removeAllListeners(<span class="string">'error'</span>);
      <span class="keyword">var</span> testError = hook.error();
      <span class="keyword">if</span> (testError) self.fail(self.test, testError);
      <span class="keyword">if</span> (err) <span class="keyword">return</span> self.failHook(hook, err);
      self.emit(<span class="string">'hook end'</span>, hook);
      next(++i);
    });
  }

  Runner.immediately(<span class="keyword">function</span>(){
    next(<span class="number">0</span>);
  });
};

<span class="comment">/**
 * Run hook `name` for the given array of `suites`
 * in order, and callback `fn(err)`.
 *
 * @param {String} name
 * @param {Array} suites
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.hooks = <span class="keyword">function</span>(name, suites, fn){
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , orig = <span class="keyword">this</span>.suite;

  <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">(suite)</span> {</span>
    self.suite = suite;

    <span class="keyword">if</span> (!suite) {
      self.suite = orig;
      <span class="keyword">return</span> fn();
    }

    self.hook(name, <span class="keyword">function</span>(err){
      <span class="keyword">if</span> (err) {
        self.suite = orig;
        <span class="keyword">return</span> fn(err);
      }

      next(suites.pop());
    });
  }

  next(suites.pop());
};

<span class="comment">/**
 * Run hooks from the top level down.
 *
 * @param {String} name
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.hookUp = <span class="keyword">function</span>(name, fn){
  <span class="keyword">var</span> suites = [<span class="keyword">this</span>.suite].concat(<span class="keyword">this</span>.parents()).reverse();
  <span class="keyword">this</span>.hooks(name, suites, fn);
};

<span class="comment">/**
 * Run hooks from the bottom up.
 *
 * @param {String} name
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.hookDown = <span class="keyword">function</span>(name, fn){
  <span class="keyword">var</span> suites = [<span class="keyword">this</span>.suite].concat(<span class="keyword">this</span>.parents());
  <span class="keyword">this</span>.hooks(name, suites, fn);
};

<span class="comment">/**
 * Return an array of parent Suites from
 * closest to furthest.
 *
 * @return {Array}
 * @api private
 */</span>

Runner.prototype.parents = <span class="keyword">function</span>(){
  <span class="keyword">var</span> suite = <span class="keyword">this</span>.suite
    , suites = [];
  <span class="keyword">while</span> (suite = suite.parent) suites.push(suite);
  <span class="keyword">return</span> suites;
};

<span class="comment">/**
 * Run the current test and callback `fn(err)`.
 *
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.runTest = <span class="keyword">function</span>(fn){
  <span class="keyword">var</span> test = <span class="keyword">this</span>.test
    , self = <span class="keyword">this</span>;

  <span class="keyword">if</span> (<span class="keyword">this</span>.asyncOnly) test.asyncOnly = <span class="literal">true</span>;

  <span class="keyword">try</span> {
    test.on(<span class="string">'error'</span>, <span class="keyword">function</span>(err){
      self.fail(test, err);
    });
    test.run(fn);
  } <span class="keyword">catch</span> (err) {
    fn(err);
  }
};

<span class="comment">/**
 * Run tests in the given `suite` and invoke
 * the callback `fn()` when complete.
 *
 * @param {Suite} suite
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.runTests = <span class="keyword">function</span>(suite, fn){
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , tests = suite.tests.slice()
    , test;

  <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">(err)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>if we bail after first err</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (self.failures &amp;&amp; suite._bail) <span class="keyword">return</span> fn();</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>next test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    test = tests.shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>all done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!test) <span class="keyword">return</span> fn();</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>grep</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> match = self._grep.test(test.fullTitle());
    <span class="keyword">if</span> (self._invert) match = !match;
    <span class="keyword">if</span> (!match) <span class="keyword">return</span> next();</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>pending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (test.pending) {
      self.emit(<span class="string">'pending'</span>, test);
      self.emit(<span class="string">'test end'</span>, test);
      <span class="keyword">return</span> next();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>execute test and hook(s)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.emit(<span class="string">'test'</span>, self.test = test);
    self.hookDown(<span class="string">'beforeEach'</span>, <span class="keyword">function</span>(){
      self.currentRunnable = self.test;
      self.runTest(<span class="keyword">function</span>(err){
        test = self.test;

        <span class="keyword">if</span> (err) {
          self.fail(test, err);
          self.emit(<span class="string">'test end'</span>, test);
          <span class="keyword">return</span> self.hookUp(<span class="string">'afterEach'</span>, next);
        }

        test.state = <span class="string">'passed'</span>;
        self.emit(<span class="string">'pass'</span>, test);
        self.emit(<span class="string">'test end'</span>, test);
        self.hookUp(<span class="string">'afterEach'</span>, next);
      });
    });
  }

  <span class="keyword">this</span>.next = next;
  next();
};

<span class="comment">/**
 * Run the given `suite` and invoke the
 * callback `fn()` when complete.
 *
 * @param {Suite} suite
 * @param {Function} fn
 * @api private
 */</span>

Runner.prototype.runSuite = <span class="keyword">function</span>(suite, fn){
  <span class="keyword">var</span> total = <span class="keyword">this</span>.grepTotal(suite)
    , self = <span class="keyword">this</span>
    , i = <span class="number">0</span>;

  debug(<span class="string">'run suite %s'</span>, suite.fullTitle());

  <span class="keyword">if</span> (!total) <span class="keyword">return</span> fn();

  <span class="keyword">this</span>.emit(<span class="string">'suite'</span>, <span class="keyword">this</span>.suite = suite);

  <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> curr = suite.suites[i++];
    <span class="keyword">if</span> (!curr) <span class="keyword">return</span> done();
    self.runSuite(curr, next);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">done</span><span class="params">()</span> {</span>
    self.suite = suite;
    self.hook(<span class="string">'afterAll'</span>, <span class="keyword">function</span>(){
      self.emit(<span class="string">'suite end'</span>, suite);
      fn();
    });
  }

  <span class="keyword">this</span>.hook(<span class="string">'beforeAll'</span>, <span class="keyword">function</span>(){
    self.runTests(suite, next);
  });
};

<span class="comment">/**
 * Handle uncaught exceptions.
 *
 * @param {Error} err
 * @api private
 */</span>

Runner.prototype.uncaught = <span class="keyword">function</span>(err){
  debug(<span class="string">'uncaught exception %s'</span>, err.message);
  <span class="keyword">var</span> runnable = <span class="keyword">this</span>.currentRunnable;
  <span class="keyword">if</span> (!runnable || <span class="string">'failed'</span> == runnable.state) <span class="keyword">return</span>;
  runnable.clearTimeout();
  err.uncaught = <span class="literal">true</span>;
  <span class="keyword">this</span>.fail(runnable, err);</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>recover from test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> (<span class="string">'test'</span> == runnable.type) {
    <span class="keyword">this</span>.emit(<span class="string">'test end'</span>, runnable);
    <span class="keyword">this</span>.hookUp(<span class="string">'afterEach'</span>, <span class="keyword">this</span>.next);
    <span class="keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>bail on hooks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.emit(<span class="string">'end'</span>);
};

<span class="comment">/**
 * Run the root suite and invoke `fn(failures)`
 * on completion.
 *
 * @param {Function} fn
 * @return {Runner} for chaining
 * @api public
 */</span>

Runner.prototype.run = <span class="keyword">function</span>(fn){
  <span class="keyword">var</span> self = <span class="keyword">this</span>
    , fn = fn || <span class="keyword">function</span>(){};

  <span class="function"><span class="keyword">function</span> <span class="title">uncaught</span><span class="params">(err)</span>{</span>
    self.uncaught(err);
  }

  debug(<span class="string">'start'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.on(<span class="string">'end'</span>, <span class="keyword">function</span>(){
    debug(<span class="string">'end'</span>);
    process.removeListener(<span class="string">'uncaughtException'</span>, uncaught);
    fn(self.failures);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>run suites</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.emit(<span class="string">'start'</span>);
  <span class="keyword">this</span>.runSuite(<span class="keyword">this</span>.suite, <span class="keyword">function</span>(){
    debug(<span class="string">'finished running'</span>);
    self.emit(<span class="string">'end'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>uncaught exception</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  process.on(<span class="string">'uncaughtException'</span>, uncaught);

  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Filter leaks with the given globals flagged as `ok`.
 *
 * @param {Array} ok
 * @param {Array} globals
 * @return {Array}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">filterLeaks</span><span class="params">(ok, globals)</span> {</span>
  <span class="keyword">return</span> filter(globals, <span class="keyword">function</span>(key){</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Firefox and Chrome exposes iframes as index inside the window object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="regexp">/^d+/</span>.test(key)) <span class="keyword">return</span> <span class="literal">false</span>;
    <span class="keyword">var</span> matched = filter(ok, <span class="keyword">function</span>(ok){
      <span class="keyword">if</span> (~ok.indexOf(<span class="string">'*'</span>)) <span class="keyword">return</span> <span class="number">0</span> == key.indexOf(ok.split(<span class="string">'*'</span>)[<span class="number">0</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Opera and IE expose global variables for HTML element IDs (issue #243)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (<span class="regexp">/^mocha-/</span>.test(key)) <span class="keyword">return</span> <span class="literal">true</span>;
      <span class="keyword">return</span> key == ok;
    });
    <span class="keyword">return</span> matched.length == <span class="number">0</span> &amp;&amp; (!global.navigator || <span class="string">'onerror'</span> !== key);
  });
}

}); <span class="comment">// module: runner.js</span>

require.register(<span class="string">"suite.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> EventEmitter = require(<span class="string">'browser/events'</span>).EventEmitter
  , debug = require(<span class="string">'browser/debug'</span>)(<span class="string">'mocha:suite'</span>)
  , milliseconds = require(<span class="string">'./ms'</span>)
  , utils = require(<span class="string">'./utils'</span>)
  , Hook = require(<span class="string">'./hook'</span>);

<span class="comment">/**
 * Expose `Suite`.
 */</span>

exports = module.exports = Suite;

<span class="comment">/**
 * Create a new `Suite` with the given `title`
 * and parent `Suite`. When a suite with the
 * same title is already present, that suite
 * is returned to provide nicer reporter
 * and more flexible meta-testing.
 *
 * @param {Suite} parent
 * @param {String} title
 * @return {Suite}
 * @api public
 */</span>

exports.create = <span class="keyword">function</span>(parent, title){
  <span class="keyword">var</span> suite = <span class="keyword">new</span> Suite(title, parent.ctx);
  suite.parent = parent;
  <span class="keyword">if</span> (parent.pending) suite.pending = <span class="literal">true</span>;
  title = suite.fullTitle();
  parent.addSuite(suite);
  <span class="keyword">return</span> suite;
};

<span class="comment">/**
 * Initialize a new `Suite` with the given
 * `title` and `ctx`.
 *
 * @param {String} title
 * @param {Context} ctx
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Suite</span><span class="params">(title, ctx)</span> {</span>
  <span class="keyword">this</span>.title = title;
  <span class="keyword">this</span>.ctx = ctx;
  <span class="keyword">this</span>.suites = [];
  <span class="keyword">this</span>.tests = [];
  <span class="keyword">this</span>.pending = <span class="literal">false</span>;
  <span class="keyword">this</span>._beforeEach = [];
  <span class="keyword">this</span>._beforeAll = [];
  <span class="keyword">this</span>._afterEach = [];
  <span class="keyword">this</span>._afterAll = [];
  <span class="keyword">this</span>.root = !title;
  <span class="keyword">this</span>._timeout = <span class="number">2000</span>;
  <span class="keyword">this</span>._slow = <span class="number">75</span>;
  <span class="keyword">this</span>._bail = <span class="literal">false</span>;
}

<span class="comment">/**
 * Inherit from `EventEmitter.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = EventEmitter.prototype;
Suite.prototype = <span class="keyword">new</span> F;
Suite.prototype.constructor = Suite;


<span class="comment">/**
 * Return a clone of this `Suite`.
 *
 * @return {Suite}
 * @api private
 */</span>

Suite.prototype.clone = <span class="keyword">function</span>(){
  <span class="keyword">var</span> suite = <span class="keyword">new</span> Suite(<span class="keyword">this</span>.title);
  debug(<span class="string">'clone'</span>);
  suite.ctx = <span class="keyword">this</span>.ctx;
  suite.timeout(<span class="keyword">this</span>.timeout());
  suite.slow(<span class="keyword">this</span>.slow());
  suite.bail(<span class="keyword">this</span>.bail());
  <span class="keyword">return</span> suite;
};

<span class="comment">/**
 * Set timeout `ms` or short-hand such as "2s".
 *
 * @param {Number|String} ms
 * @return {Suite|Number} for chaining
 * @api private
 */</span>

Suite.prototype.timeout = <span class="keyword">function</span>(ms){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._timeout;
  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> ms) ms = milliseconds(ms);
  debug(<span class="string">'timeout %d'</span>, ms);
  <span class="keyword">this</span>._timeout = parseInt(ms, <span class="number">10</span>);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Set slow `ms` or short-hand such as "2s".
 *
 * @param {Number|String} ms
 * @return {Suite|Number} for chaining
 * @api private
 */</span>

Suite.prototype.slow = <span class="keyword">function</span>(ms){
  <span class="keyword">if</span> (<span class="number">0</span> === arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._slow;
  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> ms) ms = milliseconds(ms);
  debug(<span class="string">'slow %d'</span>, ms);
  <span class="keyword">this</span>._slow = ms;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Sets whether to bail after first error.
 *
 * @parma {Boolean} bail
 * @return {Suite|Number} for chaining
 * @api private
 */</span>

Suite.prototype.bail = <span class="keyword">function</span>(bail){
  <span class="keyword">if</span> (<span class="number">0</span> == arguments.length) <span class="keyword">return</span> <span class="keyword">this</span>._bail;
  debug(<span class="string">'bail %s'</span>, bail);
  <span class="keyword">this</span>._bail = bail;
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Run `fn(test[, done])` before running tests.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.beforeAll = <span class="keyword">function</span>(fn){
  <span class="keyword">if</span> (<span class="keyword">this</span>.pending) <span class="keyword">return</span> <span class="keyword">this</span>;
  <span class="keyword">var</span> hook = <span class="keyword">new</span> Hook(<span class="string">'"before all" hook'</span>, fn);
  hook.parent = <span class="keyword">this</span>;
  hook.timeout(<span class="keyword">this</span>.timeout());
  hook.slow(<span class="keyword">this</span>.slow());
  hook.ctx = <span class="keyword">this</span>.ctx;
  <span class="keyword">this</span>._beforeAll.push(hook);
  <span class="keyword">this</span>.emit(<span class="string">'beforeAll'</span>, hook);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Run `fn(test[, done])` after running tests.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.afterAll = <span class="keyword">function</span>(fn){
  <span class="keyword">if</span> (<span class="keyword">this</span>.pending) <span class="keyword">return</span> <span class="keyword">this</span>;
  <span class="keyword">var</span> hook = <span class="keyword">new</span> Hook(<span class="string">'"after all" hook'</span>, fn);
  hook.parent = <span class="keyword">this</span>;
  hook.timeout(<span class="keyword">this</span>.timeout());
  hook.slow(<span class="keyword">this</span>.slow());
  hook.ctx = <span class="keyword">this</span>.ctx;
  <span class="keyword">this</span>._afterAll.push(hook);
  <span class="keyword">this</span>.emit(<span class="string">'afterAll'</span>, hook);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Run `fn(test[, done])` before each test case.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.beforeEach = <span class="keyword">function</span>(fn){
  <span class="keyword">if</span> (<span class="keyword">this</span>.pending) <span class="keyword">return</span> <span class="keyword">this</span>;
  <span class="keyword">var</span> hook = <span class="keyword">new</span> Hook(<span class="string">'"before each" hook'</span>, fn);
  hook.parent = <span class="keyword">this</span>;
  hook.timeout(<span class="keyword">this</span>.timeout());
  hook.slow(<span class="keyword">this</span>.slow());
  hook.ctx = <span class="keyword">this</span>.ctx;
  <span class="keyword">this</span>._beforeEach.push(hook);
  <span class="keyword">this</span>.emit(<span class="string">'beforeEach'</span>, hook);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Run `fn(test[, done])` after each test case.
 *
 * @param {Function} fn
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.afterEach = <span class="keyword">function</span>(fn){
  <span class="keyword">if</span> (<span class="keyword">this</span>.pending) <span class="keyword">return</span> <span class="keyword">this</span>;
  <span class="keyword">var</span> hook = <span class="keyword">new</span> Hook(<span class="string">'"after each" hook'</span>, fn);
  hook.parent = <span class="keyword">this</span>;
  hook.timeout(<span class="keyword">this</span>.timeout());
  hook.slow(<span class="keyword">this</span>.slow());
  hook.ctx = <span class="keyword">this</span>.ctx;
  <span class="keyword">this</span>._afterEach.push(hook);
  <span class="keyword">this</span>.emit(<span class="string">'afterEach'</span>, hook);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Add a test `suite`.
 *
 * @param {Suite} suite
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.addSuite = <span class="keyword">function</span>(suite){
  suite.parent = <span class="keyword">this</span>;
  suite.timeout(<span class="keyword">this</span>.timeout());
  suite.slow(<span class="keyword">this</span>.slow());
  suite.bail(<span class="keyword">this</span>.bail());
  <span class="keyword">this</span>.suites.push(suite);
  <span class="keyword">this</span>.emit(<span class="string">'suite'</span>, suite);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Add a `test` to this suite.
 *
 * @param {Test} test
 * @return {Suite} for chaining
 * @api private
 */</span>

Suite.prototype.addTest = <span class="keyword">function</span>(test){
  test.parent = <span class="keyword">this</span>;
  test.timeout(<span class="keyword">this</span>.timeout());
  test.slow(<span class="keyword">this</span>.slow());
  test.ctx = <span class="keyword">this</span>.ctx;
  <span class="keyword">this</span>.tests.push(test);
  <span class="keyword">this</span>.emit(<span class="string">'test'</span>, test);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Return the full title generated by recursively
 * concatenating the parent's full title.
 *
 * @return {String}
 * @api public
 */</span>

Suite.prototype.fullTitle = <span class="keyword">function</span>(){
  <span class="keyword">if</span> (<span class="keyword">this</span>.parent) {
    <span class="keyword">var</span> full = <span class="keyword">this</span>.parent.fullTitle();
    <span class="keyword">if</span> (full) <span class="keyword">return</span> full + <span class="string">' '</span> + <span class="keyword">this</span>.title;
  }
  <span class="keyword">return</span> <span class="keyword">this</span>.title;
};

<span class="comment">/**
 * Return the total number of tests.
 *
 * @return {Number}
 * @api public
 */</span>

Suite.prototype.total = <span class="keyword">function</span>(){
  <span class="keyword">return</span> utils.reduce(<span class="keyword">this</span>.suites, <span class="keyword">function</span>(sum, suite){
    <span class="keyword">return</span> sum + suite.total();
  }, <span class="number">0</span>) + <span class="keyword">this</span>.tests.length;
};

<span class="comment">/**
 * Iterates through each suite recursively to find
 * all tests. Applies a function in the format
 * `fn(test)`.
 *
 * @param {Function} fn
 * @return {Suite}
 * @api private
 */</span>

Suite.prototype.eachTest = <span class="keyword">function</span>(fn){
  utils.forEach(<span class="keyword">this</span>.tests, fn);
  utils.forEach(<span class="keyword">this</span>.suites, <span class="keyword">function</span>(suite){
    suite.eachTest(fn);
  });
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

}); <span class="comment">// module: suite.js</span>

require.register(<span class="string">"test.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> Runnable = require(<span class="string">'./runnable'</span>);

<span class="comment">/**
 * Expose `Test`.
 */</span>

module.exports = Test;

<span class="comment">/**
 * Initialize a new `Test` with the given `title` and callback `fn`.
 *
 * @param {String} title
 * @param {Function} fn
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">Test</span><span class="params">(title, fn)</span> {</span>
  Runnable.call(<span class="keyword">this</span>, title, fn);
  <span class="keyword">this</span>.pending = !fn;
  <span class="keyword">this</span>.type = <span class="string">'test'</span>;
}

<span class="comment">/**
 * Inherit from `Runnable.prototype`.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span>{</span>};
F.prototype = Runnable.prototype;
Test.prototype = <span class="keyword">new</span> F;
Test.prototype.constructor = Test;


}); <span class="comment">// module: test.js</span>

require.register(<span class="string">"utils.js"</span>, <span class="keyword">function</span>(module, exports, require){

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> fs = require(<span class="string">'browser/fs'</span>)
  , path = require(<span class="string">'browser/path'</span>)
  , join = path.join
  , debug = require(<span class="string">'browser/debug'</span>)(<span class="string">'mocha:watch'</span>);

<span class="comment">/**
 * Ignored directories.
 */</span>

<span class="keyword">var</span> ignore = [<span class="string">'node_modules'</span>, <span class="string">'.git'</span>];

<span class="comment">/**
 * Escape special characters in the given string of html.
 *
 * @param  {String} html
 * @return {String}
 * @api private
 */</span>

exports.escape = <span class="keyword">function</span>(html){
  <span class="keyword">return</span> String(html)
    .replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)
    .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)
    .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)
    .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>);
};

<span class="comment">/**
 * Array#forEach (&lt;=IE8)
 *
 * @param {Array} array
 * @param {Function} fn
 * @param {Object} scope
 * @api private
 */</span>

exports.forEach = <span class="keyword">function</span>(arr, fn, scope){
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++)
    fn.call(scope, arr[i], i);
};

<span class="comment">/**
 * Array#indexOf (&lt;=IE8)
 *
 * @parma {Array} arr
 * @param {Object} obj to find index of
 * @param {Number} start
 * @api private
 */</span>

exports.indexOf = <span class="keyword">function</span>(arr, obj, start){
  <span class="keyword">for</span> (<span class="keyword">var</span> i = start || <span class="number">0</span>, l = arr.length; i &lt; l; i++) {
    <span class="keyword">if</span> (arr[i] === obj)
      <span class="keyword">return</span> i;
  }
  <span class="keyword">return</span> -<span class="number">1</span>;
};

<span class="comment">/**
 * Array#reduce (&lt;=IE8)
 *
 * @param {Array} array
 * @param {Function} fn
 * @param {Object} initial value
 * @api private
 */</span>

exports.reduce = <span class="keyword">function</span>(arr, fn, val){
  <span class="keyword">var</span> rval = val;

  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++) {
    rval = fn(rval, arr[i], i, arr);
  }

  <span class="keyword">return</span> rval;
};

<span class="comment">/**
 * Array#filter (&lt;=IE8)
 *
 * @param {Array} array
 * @param {Function} fn
 * @api private
 */</span>

exports.filter = <span class="keyword">function</span>(arr, fn){
  <span class="keyword">var</span> ret = [];

  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++) {
    <span class="keyword">var</span> val = arr[i];
    <span class="keyword">if</span> (fn(val, i, arr)) ret.push(val);
  }

  <span class="keyword">return</span> ret;
};

<span class="comment">/**
 * Object.keys (&lt;=IE8)
 *
 * @param {Object} obj
 * @return {Array} keys
 * @api private
 */</span>

exports.keys = Object.keys || <span class="keyword">function</span>(obj) {
  <span class="keyword">var</span> keys = []
    , has = Object.prototype.hasOwnProperty <span class="comment">// for `window` on &lt;=IE8</span>

  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
    <span class="keyword">if</span> (has.call(obj, key)) {
      keys.push(key);
    }
  }

  <span class="keyword">return</span> keys;
};

<span class="comment">/**
 * Watch the given `files` for changes
 * and invoke `fn(file)` on modification.
 *
 * @param {Array} files
 * @param {Function} fn
 * @api private
 */</span>

exports.watch = <span class="keyword">function</span>(files, fn){
  <span class="keyword">var</span> options = { interval: <span class="number">100</span> };
  files.forEach(<span class="keyword">function</span>(file){
    debug(<span class="string">'file %s'</span>, file);
    fs.watchFile(file, options, <span class="keyword">function</span>(curr, prev){
      <span class="keyword">if</span> (prev.mtime &lt; curr.mtime) fn(file);
    });
  });
};

<span class="comment">/**
 * Ignored files.
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">ignored</span><span class="params">(path)</span>{</span>
  <span class="keyword">return</span> !~ignore.indexOf(path);
}

<span class="comment">/**
 * Lookup files in the given `dir`.
 *
 * @return {Array}
 * @api private
 */</span>

exports.files = <span class="keyword">function</span>(dir, ret){
  ret = ret || [];

  fs.readdirSync(dir)
  .filter(ignored)
  .forEach(<span class="keyword">function</span>(path){
    path = join(dir, path);
    <span class="keyword">if</span> (fs.statSync(path).isDirectory()) {
      exports.files(path, ret);
    } <span class="keyword">else</span> <span class="keyword">if</span> (path.match(<span class="regexp">/\.(js|coffee)$/</span>)) {
      ret.push(path);
    }
  });

  <span class="keyword">return</span> ret;
};

<span class="comment">/**
 * Compute a slug from the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

exports.slug = <span class="keyword">function</span>(str){
  <span class="keyword">return</span> str
    .toLowerCase()
    .replace(<span class="regexp">/ +/g</span>, <span class="string">'-'</span>)
    .replace(<span class="regexp">/[^-\w]/g</span>, <span class="string">''</span>);
};

<span class="comment">/**
 * Strip the function definition from `str`,
 * and re-indent for pre whitespace.
 */</span>

exports.clean = <span class="keyword">function</span>(str) {
  str = str
    .replace(<span class="regexp">/^function *\(.*\) *{/</span>, <span class="string">''</span>)
    .replace(<span class="regexp">/\s+\}$/</span>, <span class="string">''</span>);

  <span class="keyword">var</span> spaces = str.match(<span class="regexp">/^\n?( *)/</span>)[<span class="number">1</span>].length
    , re = <span class="keyword">new</span> RegExp(<span class="string">'^ {'</span> + spaces + <span class="string">'}'</span>, <span class="string">'gm'</span>);

  str = str.replace(re, <span class="string">''</span>);

  <span class="keyword">return</span> exports.trim(str);
};

<span class="comment">/**
 * Escape regular expression characters in `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

exports.escapeRegexp = <span class="keyword">function</span>(str){
  <span class="keyword">return</span> str.replace(<span class="regexp">/[-\\^$*+?.()|[\]{}]/g</span>, <span class="string">"\\$&amp;"</span>);
};

<span class="comment">/**
 * Trim the given `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */</span>

exports.trim = <span class="keyword">function</span>(str){
  <span class="keyword">return</span> str.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">''</span>);
};

<span class="comment">/**
 * Parse the given `qs`.
 *
 * @param {String} qs
 * @return {Object}
 * @api private
 */</span>

exports.parseQuery = <span class="keyword">function</span>(qs){
  <span class="keyword">return</span> exports.reduce(qs.replace(<span class="string">'?'</span>, <span class="string">''</span>).split(<span class="string">'&amp;'</span>), <span class="keyword">function</span>(obj, pair){
    <span class="keyword">var</span> i = pair.indexOf(<span class="string">'='</span>)
      , key = pair.slice(<span class="number">0</span>, i)
      , val = pair.slice(++i);

    obj[key] = decodeURIComponent(val);
    <span class="keyword">return</span> obj;
  }, {});
};

<span class="comment">/**
 * Highlight the given string of `js`.
 *
 * @param {String} js
 * @return {String}
 * @api private
 */</span>

<span class="function"><span class="keyword">function</span> <span class="title">highlight</span><span class="params">(js)</span> {</span>
  <span class="keyword">return</span> js
    .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)
    .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)
    .replace(<span class="regexp">/\/\/(.*)/gm</span>, <span class="string">'&lt;span class="comment"&gt;//$1&lt;/span&gt;'</span>)
    .replace(<span class="regexp">/('.*?')/gm</span>, <span class="string">'&lt;span class="string"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="regexp">/(\d+\.\d+)/gm</span>, <span class="string">'&lt;span class="number"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="regexp">/(\d+)/gm</span>, <span class="string">'&lt;span class="number"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="regexp">/\bnew *(\w+)/gm</span>, <span class="string">'&lt;span class="keyword"&gt;new&lt;/span&gt; &lt;span class="init"&gt;$1&lt;/span&gt;'</span>)
    .replace(<span class="regexp">/\b(function|new|throw|return|var|if|else)\b/gm</span>, <span class="string">'&lt;span class="keyword"&gt;$1&lt;/span&gt;'</span>)
}

<span class="comment">/**
 * Highlight the contents of tag `name`.
 *
 * @param {String} name
 * @api private
 */</span>

exports.highlightTags = <span class="keyword">function</span>(name) {
  <span class="keyword">var</span> code = document.getElementsByTagName(name);
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = code.length; i &lt; len; ++i) {
    code[i].innerHTML = highlight(code[i].innerHTML);
  }
};

}); <span class="comment">// module: utils.js</span>

<span class="comment">/**
 * Save timer references to avoid Sinon interfering (see GH-237).
 */</span>

<span class="keyword">var</span> Date = window.Date;
<span class="keyword">var</span> setTimeout = window.setTimeout;
<span class="keyword">var</span> setInterval = window.setInterval;
<span class="keyword">var</span> clearTimeout = window.clearTimeout;
<span class="keyword">var</span> clearInterval = window.clearInterval;

<span class="comment">/**
 * Node shims.
 *
 * These are meant only to allow
 * mocha.js to run untouched, not
 * to allow running node code in
 * the browser.
 */</span>

<span class="keyword">var</span> process = {};
process.exit = <span class="keyword">function</span>(status){};
process.stdout = {};
global = window;

<span class="comment">/**
 * Remove uncaughtException listener.
 */</span>

process.removeListener = <span class="keyword">function</span>(e){
  <span class="keyword">if</span> (<span class="string">'uncaughtException'</span> == e) {
    window.onerror = <span class="literal">null</span>;
  }
};

<span class="comment">/**
 * Implements uncaughtException listener.
 */</span>

process.on = <span class="keyword">function</span>(e, fn){
  <span class="keyword">if</span> (<span class="string">'uncaughtException'</span> == e) {
    window.onerror = <span class="keyword">function</span>(err, url, line){
      fn(<span class="keyword">new</span> Error(err + <span class="string">' ('</span> + url + <span class="string">':'</span> + line + <span class="string">')'</span>));
    };
  }
};

<span class="comment">/**
 * Expose mocha.
 */</span>

<span class="keyword">var</span> Mocha = window.Mocha = require(<span class="string">'mocha'</span>),
    mocha = window.mocha = <span class="keyword">new</span> Mocha({ reporter: <span class="string">'html'</span> });

<span class="keyword">var</span> immediateQueue = []
  , immediateTimeout;

<span class="function"><span class="keyword">function</span> <span class="title">timeslice</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> immediateStart = <span class="keyword">new</span> Date().getTime();
  <span class="keyword">while</span> (immediateQueue.length &amp;&amp; (<span class="keyword">new</span> Date().getTime() - immediateStart) &lt; <span class="number">100</span>) {
    immediateQueue.shift()();
  }
  <span class="keyword">if</span> (immediateQueue.length) {
    immediateTimeout = setTimeout(timeslice, <span class="number">0</span>);
  } <span class="keyword">else</span> {
    immediateTimeout = <span class="literal">null</span>;
  }
}

<span class="comment">/**
 * High-performance override of Runner.immediately.
 */</span>

Mocha.Runner.immediately = <span class="keyword">function</span>(callback) {
  immediateQueue.push(callback);
  <span class="keyword">if</span> (!immediateTimeout) {
    immediateTimeout = setTimeout(timeslice, <span class="number">0</span>);
  }
};

<span class="comment">/**
 * Override ui to ensure that the ui functions are initialized.
 * Normally this would happen in Mocha.prototype.loadFiles.
 */</span>

mocha.ui = <span class="keyword">function</span>(ui){
  Mocha.prototype.ui.call(<span class="keyword">this</span>, ui);
  <span class="keyword">this</span>.suite.emit(<span class="string">'pre-require'</span>, window, <span class="literal">null</span>, <span class="keyword">this</span>);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Setup mocha with the given setting options.
 */</span>

mocha.setup = <span class="keyword">function</span>(opts){
  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> opts) opts = { ui: opts };
  <span class="keyword">for</span> (<span class="keyword">var</span> opt <span class="keyword">in</span> opts) <span class="keyword">this</span>[opt](opts[opt]);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

<span class="comment">/**
 * Run mocha, returning the Runner.
 */</span>

mocha.run = <span class="keyword">function</span>(fn){
  <span class="keyword">var</span> options = mocha.options;
  mocha.globals(<span class="string">'location'</span>);

  <span class="keyword">var</span> query = Mocha.utils.parseQuery(window.location.search || <span class="string">''</span>);
  <span class="keyword">if</span> (query.grep) mocha.grep(query.grep);
  <span class="keyword">if</span> (query.invert) mocha.invert();

  <span class="keyword">return</span> Mocha.prototype.run.call(mocha, <span class="keyword">function</span>(){
    Mocha.utils.highlightTags(<span class="string">'code'</span>);
    <span class="keyword">if</span> (fn) fn();
  });
};
})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
