<!DOCTYPE html>

<html>
<head>
  <title>chart-view.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="days-collection.html">
                days-collection.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="day-model.html">
                day-model.js
              </a>
            
              
              <a class="source" href="router.html">
                router.js
              </a>
            
              
              <a class="source" href="days-collection-test.html">
                days-collection-test.js
              </a>
            
              
              <a class="source" href="day-model-test.html">
                day-model-test.js
              </a>
            
              
              <a class="source" href="backbone.html">
                backbone.js
              </a>
            
              
              <a class="source" href="bootstrap.html">
                bootstrap.js
              </a>
            
              
              <a class="source" href="chai.html">
                chai.js
              </a>
            
              
              <a class="source" href="jquery.html">
                jquery.js
              </a>
            
              
              <a class="source" href="mocha.html">
                mocha.js
              </a>
            
              
              <a class="source" href="raphael.html">
                raphael.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="text.html">
                text.js
              </a>
            
              
              <a class="source" href="underscore.html">
                underscore.js
              </a>
            
              
              <a class="source" href="chart-view.html">
                chart-view.js
              </a>
            
              
              <a class="source" href="default-view.html">
                default-view.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chart-view.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/* global define: true */</span>
<span class="comment">/* global _: true */</span>

define([<span class="string">"jquery"</span>, <span class="string">"backbone"</span>, <span class="string">"raphael"</span>], <span class="keyword">function</span>($, Backbone, Raphael) {
  <span class="string">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Chart View</h2>
<p>It knows how to display Visits, Value and Value per Visit.
It renders draggable dots on Visits and Value lines.
You can drag these dots to change models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> ChartView = Backbone.View.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>How many points should be shown on each chart&#39;s line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pointsInLine: <span class="number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Chart&#39;s margin. It makes sence only for lines. Scales can be placed
inside margin area.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    margin:
    {
      top: <span class="number">50</span>,
      right: <span class="number">50</span>,
      bottom: <span class="number">50</span>,
      left: <span class="number">55</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We look for maximum attribute value to render lines in proper scale,
but if maximum attribute value is to small, it&#39;s good to increase it
in order to make point drag smoother.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    minimalMax: <span class="number">50</span>,

    initialize: <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Make sure whar input collection is uniformly filled.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.options.models.complement();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Shrink collection to not overload user with big ammount of movable
points.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.collection = <span class="keyword">this</span>.options.models.shrink(<span class="keyword">this</span>.pointsInLine);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>this.$el.height() is a whole view height but heightMinusMargins()
return you a view&#39;s height without margins. Sincerely, yours C.O.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    heightMinusMargins: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.$el.height() - <span class="keyword">this</span>.margin.top - <span class="keyword">this</span>.margin.bottom;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>see heightMinusMargins</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    widthMinusMargins: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.$el.width() - <span class="keyword">this</span>.margin.left - <span class="keyword">this</span>.margin.right;
    },

    render: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Let&#39;s start from blank scheet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.$el.empty();

      self.paper = <span class="keyword">new</span> Raphael(self.el, self.$el.width(), self.$el.height());</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>This is a x-distance between draggable points.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.columnWidth =
        Math.floor(self.widthMinusMargins() / self.collection.length);

      self.renderPaths();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>No time to explain: render paths!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderPaths: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>visits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderPath(</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>path name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="string">"visitsPath"</span>,
        {
          color: <span class="string">"#4892D2"</span>,
          cursor: <span class="string">"move"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">function</span>(model) {
          <span class="keyword">return</span> Math.floor(parseInt(model.get(<span class="string">"visits"</span>), <span class="number">10</span>));
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>setter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">function</span>(model, visits) {
          model.set(<span class="string">"visits"</span>, visits);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderPath(</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>path name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="string">"valuesPath"</span>,
        {
          color: <span class="string">"#FAD500"</span>,
          cursor: <span class="string">"move"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">function</span>(model) {
          <span class="keyword">return</span> Math.floor(parseInt(model.get(<span class="string">"value"</span>), <span class="number">10</span>));
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>setter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">function</span>(model, value) {
          model.set(<span class="string">"value"</span>, value);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>value per visit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderPath(</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>path name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="string">"valuePerVisitPath"</span>,
        {
          color: <span class="string">"#4CB849"</span>,
          cursor: <span class="string">"hand"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">2</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">function</span>(model) {
          <span class="keyword">var</span> visits = parseInt(model.get(<span class="string">"visits"</span>), <span class="number">10</span>);
          <span class="keyword">var</span> value = parseInt(model.get(<span class="string">"value"</span>), <span class="number">10</span>);
          <span class="keyword">if</span> (visits &gt; <span class="number">0</span>) {
            <span class="keyword">return</span> Math.floor(value / visits);
          }
          <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="number">0</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>threre are no setter here because Value per Visit is calculated based on
Value and Visits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      );
    },

    getAnchors: <span class="keyword">function</span>(p1x, p1y, p2x, p2y, p3x, p3y) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Every time I see this code I tryind to remember what it means.
In short, it takes 3 points coordinates: previous dot in chart&#39;s line,
current point and the next point.
Then it makes some trigonometry and returns two points.
If you link these points by line, the (p2x, p2y) point
will be in the middle of this line.
I took this code here, BTW:
<a href="https://github.com/DmitryBaranovskiy/g.raphael/blob/master/g.line.js">https://github.com/DmitryBaranovskiy/g.raphael/blob/master/g.line.js</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> l1 = (p2x - p1x) / <span class="number">2</span>;
      <span class="keyword">var</span> l2 = (p3x - p2x) / <span class="number">2</span>;

      <span class="keyword">var</span> a = Math.atan((p2x - p1x) / Math.abs(p2y - p1y));
      <span class="keyword">var</span> b = Math.atan((p3x - p2x) / Math.abs(p2y - p3y));

      <span class="keyword">if</span> (p1y &lt; p2y) {
        a = Math.PI - a;
      }

      <span class="keyword">if</span> (p3y &lt; p2y) {
        b = Math.PI - b;
      }

      <span class="keyword">var</span> alpha = Math.PI / <span class="number">2</span> - ((a + b) % (Math.PI * <span class="number">2</span>)) / <span class="number">2</span>;

      <span class="keyword">var</span> dx1 = l1 * Math.sin(alpha + a);
      <span class="keyword">var</span> dy1 = l1 * Math.cos(alpha + a);
      <span class="keyword">var</span> dx2 = l2 * Math.sin(alpha + b);
      <span class="keyword">var</span> dy2 = l2 * Math.cos(alpha + b);

      <span class="keyword">return</span> {
        x1: p2x - dx1,
        y1: p2y + dy1,
        x2: p2x + dx2,
        y2: p2y + dy2
      };
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>This renders a line, a draggable dots on this line and the other stuff
related to (separately) Visits, Value or Value per Visit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderPath: <span class="keyword">function</span>(pathName, attributes, getter, setter) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Find maximum value of given model attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> maxModelAttributeValue =
        Math.max(
          getter(_.max(
            self.collection.models,
            <span class="keyword">function</span>(model) {
              <span class="keyword">return</span> parseInt(getter(model), <span class="number">10</span>);
            })),
          self.minimalMax);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>How much y increases if we increase model attribute by 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> yPerModel =
        self.heightMinusMargins() /
          maxModelAttributeValue;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>The x-distance between two draggable points.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> xPerModel = self.widthMinusMargins() /
        (self.collection.models.length - <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Create a path an set its style.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> path = self.paper.path().attr({
        stroke: attributes.color,
        <span class="string">"stroke-width"</span>: attributes[<span class="string">"stroke-width"</span>],
        <span class="string">"stroke-linejoin"</span>: <span class="string">"round"</span>
      });

      <span class="keyword">var</span> p, x, y;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Move through all the models in view&#39;s collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; self.collection.models.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Remember dots in getAnchors? That&#39;s why we need three models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> prevModel = self.collection.models[i - <span class="number">1</span>];
        <span class="keyword">var</span> model = self.collection.models[i];
        <span class="keyword">var</span> nextModel = self.collection.models[i + <span class="number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Get current draggable point coordinates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        y = self.heightMinusMargins() -
          yPerModel * getter(model) + self.margin.top;
        x = xPerModel * i + self.margin.left;

        <span class="keyword">if</span> (i === <span class="number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>First time here? Try to start a path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          p = [<span class="string">"M"</span>, x, y, <span class="string">"C"</span>, x, y];
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (i !== <span class="number">0</span> &amp;&amp; i &lt; self.collection.models.length - <span class="number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>y of previous point in line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">var</span> Y0 = self.heightMinusMargins() -
            yPerModel * getter(prevModel);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>x of prevous point in line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">var</span> X0 = xPerModel * (i - <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>y of next point in line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">var</span> Y2 = self.heightMinusMargins() -
            yPerModel * getter(nextModel);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>x of next point in line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">var</span> X2 = xPerModel * (i + <span class="number">1</span>);

          <span class="keyword">var</span> a = self.getAnchors(X0, Y0, x, y, X2, Y2);

          p = p.concat([a.x1, a.y1, x, y, a.x2, a.y2]);
        }

        <span class="keyword">if</span> (setter !== <span class="literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>We dont&#39;t draw draggable dots if we don&#39;t have a setter.
Because we don&#39;t know how to handle such drags.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.renderDot(x, y, i, attributes, model, yPerModel, setter);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>The last path&#39;s span.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      p = p.concat([x, y, x, y]);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Add array to our path and move it (path) to back (to not cover
the dots).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      path.attr({
        path: p
      }).toBack();</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>save a link to path (we need it do delete this path later).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self[pathName] = path;

      self.renderScales();
    },

    removePath: <span class="keyword">function</span>(pathName) {
      <span class="keyword">var</span> path = <span class="keyword">this</span>[pathName];
      <span class="keyword">if</span> (path !== <span class="literal">undefined</span> &amp;&amp; path.remove !== <span class="literal">undefined</span>) {
        path.remove();
      }
    },

    renderDot: <span class="keyword">function</span>(x, y, i, attributes, model, yPerModel, setter) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;

      <span class="keyword">var</span> currentY;

      <span class="keyword">var</span> radius = <span class="number">5</span>;

      self.paper
        .circle(x, y, radius)
        .data(<span class="string">"models-i"</span>, i)
        .attr(
        {
          cursor: attributes.cursor,
          fill: <span class="string">"#FFF"</span>,
          stroke: attributes.color,
          <span class="string">"stroke-width"</span>: <span class="number">3</span>,
          <span class="string">"title"</span>: <span class="string">"Visits: "</span> + model.get(<span class="string">"visits"</span>) +
            <span class="string">"\nValue: "</span> + model.get(<span class="string">"value"</span>) +
            <span class="string">"\nValue per Visit: "</span> +
              model.getValuePerVisit() +
            <span class="string">"\nDate: "</span> + model.id
        })
        .drag(</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>onmove</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">function</span>(dx, dy) {
            <span class="keyword">var</span> circle = <span class="keyword">this</span>;

            <span class="function"><span class="keyword">function</span> <span class="title">getAttributeValue</span><span class="params">()</span> {</span>
              <span class="keyword">var</span> cy = currentY + dy;

              <span class="keyword">if</span> (self.heightMinusMargins() + self.margin.top - cy &lt; <span class="number">0</span>) {
                cy = self.heightMinusMargins() + self.margin.top;
              }

              <span class="keyword">var</span> attributeValue = Math.floor(
                (self.heightMinusMargins() - cy + self.margin.top) /
                  yPerModel);

              <span class="keyword">return</span> attributeValue;
            }

            <span class="keyword">var</span> attributeValue = getAttributeValue();

            setter(
              self.collection.models[circle.data(<span class="string">"models-i"</span>)],
              attributeValue);

            self.paper.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(el)</span> {</span>
              <span class="keyword">if</span> (el.type === <span class="string">"circle"</span>) {
                el.hide();
              }
            });

            self.removePath(<span class="string">"visitsPath"</span>);
            self.removePath(<span class="string">"valuesPath"</span>);
            self.removePath(<span class="string">"valuePerVisitPath"</span>);

            self.renderPaths();
            self.renderScales();
          },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>onstart</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">function</span>() {
            currentY = <span class="keyword">this</span>.attr(<span class="string">"cy"</span>);
          },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>onend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">function</span>() {
            self.render();
          })
        .toBack();
    },

    renderLine: <span class="keyword">function</span>(x0, y0, x1, y1) {
      <span class="keyword">return</span> <span class="keyword">this</span>.paper.path(<span class="string">"M"</span> + x0 + <span class="string">","</span> + y0 + <span class="string">"L"</span> + x1 + <span class="string">","</span> + y1);
    },

    renderScales: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.renderVisitsScale();
      <span class="keyword">this</span>.renderValueScale();
      <span class="keyword">this</span>.renderValuePerVisitScale();
    },

    renderVisitsScale: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>todo: this should be a single path</p>
<p>vertical scale line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom,</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins())
        .attr(
        {
          stroke: <span class="string">"#4892D2"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>upper horizontal line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + <span class="number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) - <span class="number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + <span class="number">2</span>)
        .attr(
        {
          stroke: <span class="string">"#4892D2"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>bottom horizontal line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins() - <span class="number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) - <span class="number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins() - <span class="number">2</span>)
        .attr(
        {
          stroke: <span class="string">"#4892D2"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        });

      <span class="keyword">if</span> (self.paper.maxVisitsText !== <span class="literal">undefined</span>) {
        self.paper.maxVisitsText.remove();
      }

      self.paper.maxVisitsText = self.paper.text(</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) - <span class="number">12</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.top,</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          _.max(
            self.collection.models,
            <span class="keyword">function</span>(model) {
              <span class="keyword">return</span> parseInt(model.get(<span class="string">"visits"</span>), <span class="number">10</span>);
            }).get(<span class="string">"visits"</span>))
        .rotate(-<span class="number">90</span>)
        .attr(
        {
          <span class="string">"color"</span>: <span class="string">"#565d64"</span>,
          <span class="string">"text-anchor"</span>: <span class="string">"end"</span>,
          <span class="string">"font-size"</span>: <span class="number">14</span>
        });

      <span class="keyword">if</span> (self.paper.zeroVisitsText === <span class="literal">undefined</span>) {
        self.paper.zeroVisitsText = self.paper.text(</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) - <span class="number">12</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.top + self.heightMinusMargins(),</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="string">"0"</span>)
        .rotate(-<span class="number">90</span>)
        .attr(
        {
          <span class="string">"color"</span>: <span class="string">"#565d64"</span>,
          <span class="string">"text-anchor"</span>: <span class="string">"start"</span>,
          <span class="string">"font-size"</span>: <span class="number">14</span>
        });
      }
    },

    renderValueScale: <span class="keyword">function</span>() {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>todo: this should be a single path</p>
<p>vertical scale line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(<span class="keyword">this</span>.margin.left / <span class="number">2</span>) + <span class="number">4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom,</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins())
        .attr(
        {
          stroke: <span class="string">"#FAD500"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>upper horizontal line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + <span class="number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">9</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + <span class="number">2</span>)
        .attr(
        {
          stroke: <span class="string">"#FAD500"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>bottom horizontal line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins() - <span class="number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">9</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins() - <span class="number">2</span>)
        .attr(
        {
          stroke: <span class="string">"#FAD500"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">4</span>
        });

      <span class="keyword">if</span> (self.paper.maxValueText !== <span class="literal">undefined</span>) {
        self.paper.maxValueText.remove();
      }

      self.paper.maxValueText = self.paper.text(</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">15</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.top,</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          _.max(
            self.collection.models,
            <span class="keyword">function</span>(model) {
              <span class="keyword">return</span> parseInt(model.get(<span class="string">"value"</span>), <span class="number">10</span>);
            }).get(<span class="string">"value"</span>))
        .rotate(-<span class="number">90</span>)
        .attr(
        {
          <span class="string">"color"</span>: <span class="string">"#565d64"</span>,
          <span class="string">"text-anchor"</span>: <span class="string">"end"</span>,
          <span class="string">"font-size"</span>: <span class="number">14</span>
        });

      <span class="keyword">if</span> (self.paper.zeroValueText === <span class="literal">undefined</span>) {
        self.paper.zeroValueText = self.paper.text(</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          Math.floor(self.margin.left / <span class="number">2</span>) + <span class="number">15</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.top + self.heightMinusMargins(),</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="string">"0"</span>)
        .rotate(-<span class="number">90</span>)
        .attr(
        {
          <span class="string">"color"</span>: <span class="string">"#565d64"</span>,
          <span class="string">"text-anchor"</span>: <span class="string">"start"</span>,
          <span class="string">"font-size"</span>: <span class="number">14</span>
        });
      }
    },

    renderValuePerVisitScale: <span class="keyword">function</span>() {
      <span class="comment">/*var x0 = this.margin.left + this.widthMinusMargins() +
        Math.floor(this.margin.right / 2);
      var y0 = this.margin.bottom;
      var x1 = x0;
      var y1 = this.margin.bottom + this.heightMinusMargins();
      this.renderLine(x0, y0, x1, y1).attr(
        {
          stroke: "#4CB849",
          "stroke-width": 1
        });*/</span>
      <span class="keyword">var</span> self = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>todo: this should be a single path</p>
<p>vertical scale line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom,</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins())
        .attr(
        {
          stroke: <span class="string">"#4CB849"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">1</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>upper horizontal line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + <span class="number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>) + <span class="number">4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + <span class="number">1</span>)
        .attr(
        {
          stroke: <span class="string">"#4CB849"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">1</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>bottom horizontal line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      self.renderLine(</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>x0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>y0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins() - <span class="number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>x1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>) + <span class="number">4</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>y1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.bottom + self.heightMinusMargins() - <span class="number">1</span>)
        .attr(
        {
          stroke: <span class="string">"#4CB849"</span>,
          <span class="string">"stroke-width"</span>: <span class="number">1</span>
        });

      <span class="keyword">if</span> (self.paper.valuePerVisitText !== <span class="literal">undefined</span>) {
        self.paper.valuePerVisitText.remove();
      }

      self.paper.valuePerVisitText = self.paper.text(</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>) + <span class="number">12</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.top,</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          _.max(
            self.collection.models,
            <span class="keyword">function</span>(model) {
              <span class="keyword">return</span> model.getValuePerVisit();
            }).getValuePerVisit())
        .rotate(-<span class="number">90</span>)
        .attr(
        {
          <span class="string">"color"</span>: <span class="string">"#565d64"</span>,
          <span class="string">"text-anchor"</span>: <span class="string">"end"</span>,
          <span class="string">"font-size"</span>: <span class="number">14</span>
        });

      <span class="keyword">if</span> (self.paper.zeroValuePerVisitText === <span class="literal">undefined</span>) {
        self.paper.zeroValuePerVisitText = self.paper.text(</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">this</span>.margin.left + <span class="keyword">this</span>.widthMinusMargins() +
            Math.floor(<span class="keyword">this</span>.margin.right / <span class="number">2</span>) + <span class="number">12</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self.margin.top + self.heightMinusMargins(),</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="string">"0"</span>)
        .rotate(-<span class="number">90</span>)
        .attr(
        {
          <span class="string">"color"</span>: <span class="string">"#565d64"</span>,
          <span class="string">"text-anchor"</span>: <span class="string">"start"</span>,
          <span class="string">"font-size"</span>: <span class="number">14</span>
        });
      }
    }

  });

  <span class="keyword">return</span> ChartView;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
